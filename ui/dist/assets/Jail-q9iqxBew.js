import{u as h,r as u,k as L,bH as p,J as l,a2 as H,n as D,j as a,o as f,ag as x,a as t,L as s,g as M,K,bu as B,bp as y,F as k,bR as g,bJ as j,bS as b,O as U,bT as _,i as S,Y as q,bC as G,bq as V,bs as Y,a1 as w,h as W}from"./index-BmPcK3sZ.js";const d=U([]),I=U(null);function Q(){var C;const i=h(d),E=h(I),A=h(w.APPS.POLICE.permissions),[c,v]=u.useState(""),[N,J]=u.useState("");u.useEffect(()=>{L("Police",{action:"getJailees",query:c},p.jail.filter(e=>e.name.toLowerCase().includes(c.toLowerCase()))).then(e=>{if(!e)return l("warning","No data received");d.set(e)})},[c]);const{handleScroll:R}=H({fetchData:()=>L("Police",{action:"getJailees",query:c,lastId:i[i.length-1].id}),onDataFetched:e=>d.set([...d.value,...e]),perPage:10});u.useEffect(()=>{const e=setTimeout(()=>v(N),500);return()=>clearTimeout(e)},[N]);const O=e=>{L("Police",{action:"getJailee",id:e},p.jail.find(o=>o.id===e)).then(o=>{if(!o)return l("warning","No data received");I.set(o)})},m=()=>{let e={};_.set({type:"profiles",filter:"excludeJailed",onSelect:r=>{e.user=r,S.PopUp.set({title:s("APPS.POLICE.JAIL.JAIL_PERSON.TITLE"),description:s("APPS.POLICE.JAIL.JAIL_PERSON.DESCRIPTION",{name:r==null?void 0:r.name}),inputs:[{type:"number",placeholder:s("APPS.POLICE.JAIL.JAIL_PERSON.SENTENCE_PLACEHOLDER"),min:"1",onChange:P=>{e.sentence=parseInt(P)}}],textarea:{placeholder:s("APPS.POLICE.JAIL.JAIL_PERSON.REASON_PLACEHOLDER"),maxCharacters:500,onChange:P=>{e.reason=P}},buttons:[{title:s("APPS.POLICE.CANCEL")},{title:s("APPS.POLICE.PROCEED"),cb:()=>o()}]})}});const o=()=>{S.ContextMenu.set({buttons:[{title:s("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITH_CASE"),color:"red",cb:()=>{if(!e.sentence||!e.reason){setTimeout(()=>{S.PopUp.set({title:s("APPS.POLICE.JAIL.ERROR.TITLE"),description:s("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:s("APPS.POLICE.OK")}]})},300),l("error","No sentence or description provided");return}_.set({type:"cases",onSelect:r=>{e.case={id:r.id,label:r.label},n({user:e.user,sentence:e.sentence,reason:e.reason,case:e.case})}})}},{title:s("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITHOUT_CASE"),cb:()=>{if(!e.sentence||!e.reason){setTimeout(()=>{S.PopUp.set({title:s("APPS.POLICE.JAIL.ERROR.TITLE"),description:s("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:s("APPS.POLICE.OK")}]})},300),l("error","No sentence or description provided");return}n({user:e.user,sentence:e.sentence,reason:e.reason})}}]})},n=r=>{var P;if(!r.user)return l("error","No user provided");if(!r.reason&&r.reason.length>10)return l("error","No reason provided / reason is below 10 characters");if(!r.sentence&&r.sentence>0)return l("error","No sentence provided / sentence is below 0");L("Police",{action:"jailPlayer",data:{id:(P=r.user)==null?void 0:P.id,description:r.reason,case:r.case,sentence:r.sentence}},!0).then(F=>{if(!F)return l("error","Failed to jail person");l("info","Successfully jailed person")})}};return D("police:newPrisoner",e=>{if(!e)return l("error","No data received for police:newPrisoner");d.set([e,...d.value])}),D("police:prisonerReleased",e=>{if(!e)return l("error","No data received for police:prisonerReleased");d.set(d.value.filter(o=>o.id!==e))}),a(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:E?a(x,{children:a(z,{})}):a("main",{className:"main profiles",children:t("div",{className:"page",children:[t("div",{className:"top",children:[a("div",{className:"title",children:s("APPS.POLICE.JAIL.TITLE")}),((C=A==null?void 0:A.jail)==null?void 0:C.create)&&t("div",{className:"button",onClick:m,children:[a(M,{}),s("APPS.POLICE.ADD")]})]}),a(K,{placeholder:s("APPS.POLICE.JAIL.SEARCH"),onChange:e=>J(e.target.value)}),t("div",{className:"items",onScroll:R,children:[i.length===0&&c.length==0&&a("div",{className:"no-results",children:s("APPS.POLICE.SEARCH_FOR",{query:s("APPS.POLICE.JAIL.JAILED_PERSON").toLowerCase()})}),i.length===0&&c.length>0&&a("div",{className:"no-results",children:s("APPS.POLICE.NO_RESULTS_FOR",{query:c})}),i.map((e,o)=>{let n=o===i.length-1?"last":"";return t(f.div,{...B,id:n,className:"item",onClick:()=>O(e.id),children:[a("img",{src:y(e.avatar,"profile")}),t("div",{className:"info",children:[a("div",{className:"name",children:e.name}),a("div",{className:"subtitle",children:e.description.substring(0,150)}),t("div",{className:"cards",children:[e.case&&t(k,{children:[t("div",{className:"card blue clickable",onClick:r=>{r.stopPropagation(),L("Police",{action:"getCase",id:e.case.id},p.cases.find(P=>P.id===e.case.id)).then(P=>{if(!P)return l("error","Failed to fetch case");g.set(P),j.set("cases")})},children:[e.case.label," (",e.case.id,")"]}),a("div",{className:"divider"})]}),a("div",{className:"card blue",children:s("APPS.POLICE.JAIL.JAILED_BY_NAME",{name:e==null?void 0:e.jailedBy})}),a("div",{className:"card red",children:s("APPS.POLICE.JAIL.REMAINING_TIME_DATE",{time:T(e.remainingTime),date:b(e.releasedAt)})})]})]})]},o)})]})]})})})}const z=()=>{var m,C,e,o;const i=h(I),E=h(W),A=h(w.APPS.POLICE.permissions),[c,v]=u.useState(!1),N=u.useRef(!1),J=()=>{if(!N.current){l("info","No changes have been made to the case"),g.reset();return}L("Police",{action:"updateJailee",data:{id:i.id,description:i.description,case:i.case}}).then(n=>{n&&(d.set(d.value.map(r=>r.id===i.id?i:r)),I.reset())})},R=()=>{S.PopUp.set({title:s("APPS.POLICE.JAIL.UNJAIL_PERSON.TITLE"),description:s("APPS.POLICE.JAIL.UNJAIL_PERSON.DESCRIPTION",{name:i==null?void 0:i.name}),buttons:[{title:s("APPS.POLICE.CANCEL")},{title:s("APPS.POLICE.JAIL.UNJAIL_PERSON.PROCEED"),color:"red",cb:()=>{L("Police",{action:"unjail",id:i.id},!0).then(n=>{if(!n)return l("error","Failed to unjail person");d.set(d.value.filter(r=>r.id!==i.id)),I.reset()})}}]})};let O=u.useRef(!0);return u.useEffect(()=>{if(i){if(O.current){O.current=!1;return}N.current=!0}},[i]),a(f.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:i&&t(k,{children:[t("div",{className:"grid-header",children:[t("div",{className:"back",onClick:()=>I.reset(),children:[a(q,{})," ",s("APPS.POLICE.BACK")]}),t("div",{className:"buttons",children:[((m=A.jail)==null?void 0:m.unjail)&&((e=(C=E==null?void 0:E.Police)==null?void 0:C.Jail)==null?void 0:e.CanUnjail)&&!c&&a("div",{className:"button red",onClick:R,children:s("APPS.POLICE.JAIL.UNJAIL")}),c&&a("div",{className:"button red",onClick:()=>v(!1),children:s("APPS.POLICE.CANCEL")}),((o=A==null?void 0:A.jail)==null?void 0:o.edit)&&a("div",{className:"button",onClick:()=>{c?J():v(!0)},children:c?s("APPS.POLICE.SAVE"):s("APPS.POLICE.EDIT")})]})]}),t("div",{className:"grid-body",style:{gridTemplateAreas:`
                                'profile profile'
                                'description reports'
                                'description .'
                         `,overflowY:"auto"},children:[t("div",{className:"grid-item",style:{gridArea:"profile"},children:[a("div",{className:"top",children:a("div",{className:"title",children:s("APPS.POLICE.JAIL.PROFILE")})}),a("div",{className:"items","data-overflow":"false",children:t("div",{className:"item profile",children:[t("div",{className:"left",children:[a("div",{className:"mugshot",children:a("img",{src:y(i.avatar,"profile"),onClick:()=>{i.avatar&&S.FullscreenImage.set(i.avatar)}})}),a("div",{className:"info",children:a("div",{className:"name",children:i.name})})]}),t("div",{className:"details",children:[t("div",{className:"item",children:[a("span",{children:s("APPS.POLICE.JAIL.JAILED_BY")}),a("div",{className:"value",children:i.jailedBy})]}),t("div",{className:"item",children:[a("span",{children:s("APPS.POLICE.JAIL.JAILED_AT")}),a("div",{className:"value",children:b(i.jailedAt)})]}),t("div",{className:"item",children:[a("span",{children:s("APPS.POLICE.JAIL.REMAINING_TIME")}),a("div",{className:"value",children:T(i.remainingTime)})]}),t("div",{className:"item",children:[a("span",{children:s("APPS.POLICE.JAIL.ORIGINAL_SENTENCE")}),a("div",{className:"value",children:T(i.originalTime)})]}),t("div",{className:"item",children:[a("span",{children:s("APPS.POLICE.JAIL.RELEASE_DATE")}),a("div",{className:"value",children:b(i.releasedAt)})]})]})]})})]}),t("div",{className:"grid-item",style:{gridArea:"description",height:"20vh"},children:[a("div",{className:"top",children:a("div",{className:"title",children:s("APPS.POLICE.JAIL.DESCRIPTION")})}),a("div",{className:"items","data-overflow":"false",children:a(G,{id:`police-jail-${i.id}`,liveEdit:!!(i!=null&&i.id),value:i.description,onChange:n=>I.patch({description:n}),placeholder:s("APPS.POLICE.JAIL.DESCRIPTION_PLACEHOLDER"),height:"100%",editMode:c})})]}),t("div",{className:"grid-item",style:{gridArea:"reports"},children:[t("div",{className:"top",children:[a("div",{className:"title",children:s("APPS.POLICE.JAIL.LINKED_CASE")}),c&&t(f.div,{...V,className:"button",onClick:()=>{_.set({type:"cases",onSelect:n=>{I.set({...I.value,case:{id:n.id,label:n.label}})}})},children:[a(M,{}),s("APPS.POLICE.ADD")]})]}),t("div",{className:"items",children:[!i.case&&a("div",{className:"no-results",children:s("APPS.POLICE.JAIL.NO_LINKED_CASE")}),a("div",{className:"cards",children:i.case&&t("div",{className:Y("card blue clickable"),onClick:()=>{c?S.PopUp.set({title:s("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.TITLE"),description:s("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.DESCRIPTION"),buttons:[{title:s("APPS.POLICE.CANCEL")},{title:s("APPS.POLICE.REMOVE"),color:"red",cb:()=>{I.set({...I.value,case:null})}}]}):L("Police",{action:"getCase",id:i.case.id},p.cases.find(n=>n.id===i.case.id)).then(n=>{if(!n)return l("error","Failed to fetch case");g.set(n),j.set("cases")})},children:[i.case.label," (",i.case.id,")"]})})]})]})]})]})})},T=i=>{if(!i)return s("APPS.POLICE.MISC.UNKNOWN");if(i<0)return s("APPS.POLICE.JAIL.RELEASED");if(i<3600){const E=Math.floor(i/60);return E<1?s("APPS.POLICE.JAIL.LESS_THAN_MINUTE"):s("APPS.POLICE.MISC.MINUTES",{minutes:E.toString()})}if(i<86400){const E=Math.floor(i/3600);return s("APPS.POLICE.MISC.HOURS",{hours:E.toString()})}return s("APPS.POLICE.MISC.DAYS",{days:Math.floor(i/86400).toString()})};export{Q as default};
