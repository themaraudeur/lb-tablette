import{u as N,r as C,k as v,bw as g,J as m,n as b,bA as O,j as n,o as I,a as E,L as a,g as T,K as M,ag as U,O as S,ay as D,bu as w,bz as k,bB as y,I as H,F as f,bs as x,bC as F,a1 as p,i as h}from"./index-BmPcK3sZ.js";const l=S([]),s=S(null);function q(){var d;const e=N(l),r=N(s),c=N(p.APPS.AMBULANCE.permissions),[i,L]=C.useState(""),[u,P]=C.useState("");return C.useEffect(()=>{v("Ambulance",{action:"getBulletinBoard",query:i},g.bulletinBoard.filter(t=>t.title.toLowerCase().includes(i.toLowerCase())||t.content.toLowerCase().includes(i.toLowerCase()))).then(t=>{if(!t)return m("warning","getBulletinBoard did not return any data");l.set(t)})},[i]),b("ambulance:bulletinCreated",t=>{var o;if(!t)return m("error","No data provided in bulletinCreated event");l.set([{...t,created:t.createdBy===((o=O.value)==null?void 0:o.id)},...l.value])}),b("ambulance:bulletinUpdated",t=>{if(!t)return m("error","No data provided in bulletinUpdated event");l.set(l.value.map(o=>o.id===t.id?{...o,title:t.title,content:t.content,timestamp:new Date().getTime()}:o))}),b("ambulance:bulletinDeleted",t=>{var o;if(!t)return m("error","No ID provided in bulletinDeleted event");l.set(l.value.filter(A=>A.id!==t)),t===((o=s.value)==null?void 0:o.id)&&s.set(null)}),C.useEffect(()=>{const t=setTimeout(()=>L(u),500);return()=>clearTimeout(t)},[u]),n(I.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:E("main",{className:"main bulletins",children:[E("div",{className:"chats bulletin",children:[E("div",{className:"top",children:[n("div",{className:"title",children:a("APPS.POLICE.BULLETIN.LABEL")}),n("div",{className:"buttons",children:((d=c==null?void 0:c.bulletin)==null?void 0:d.create)&&E("div",{className:"button",onClick:()=>s.set({}),children:[n(T,{}),a("APPS.POLICE.NEW")]})})]}),n(M,{placeholder:a("APPS.POLICE.BULLETIN.SEARCH"),onChange:t=>P(t.target.value)}),n("div",{className:"items",children:e.sort((t,o)=>t.timestamp>o.timestamp?-1:1).sort((t,o)=>t.pinned===o.pinned?0:t.pinned?-1:1).filter(t=>t.title.toLowerCase().includes(i.toLowerCase())||t.content.toLowerCase().includes(i.toLowerCase())).map(t=>n(_,{data:t},t.id))})]}),n("div",{className:"bulletin active",children:n(U,{children:r&&n(R,{})})})]})})}const _=({data:e})=>{var u;const r=D(()=>{var P,d,t;!((P=p.APPS.AMBULANCE.permissions.value)!=null&&P.bulletin.pin)&&!(e!=null&&e.created)||h.ContextMenu.set({buttons:[((d=p.APPS.AMBULANCE.permissions.value)==null?void 0:d.bulletin.pin)&&{title:e.pinned?a("APPS.POLICE.HOME.UNPIN"):a("APPS.POLICE.HOME.PIN"),color:e.pinned?"red":null,cb:()=>{v("Ambulance",{action:"toggleBulletinPinned",id:e.id,pinned:!e.pinned},!0).then(o=>{if(!o)return m("error","Failed to toggle pinned bulletin");l.set(l.value.map(A=>A.id===e.id?{...A,pinned:!A.pinned}:A))})}},(e.created||((t=p.APPS.AMBULANCE.permissions.value)==null?void 0:t.bulletin.delete))&&{title:a("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{h.PopUp.set({title:a("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:a("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.DELETE"),color:"red",cb:()=>{v("Ambulance",{action:"deleteBulletin",id:e.id},!0).then(o=>{if(!o)return m("error","Failed to delete bulletin");l.set(l.value.filter(A=>A.id!==e.id))})}}]})}}]})}),c=P=>{var d;if(P.id===((d=s.value)==null?void 0:d.id))return s.set(null);s.set(P)};let i=(u=e==null?void 0:e.content)==null?void 0:u.replace(/[*#_\-\[\]\n]/g," "),L=(i==null?void 0:i.length)>75?(i==null?void 0:i.slice(0,75))+"...":i;return E(I.div,{...r,...w,className:"item bulletin-item",onClick:()=>c(e),children:[E("div",{className:"info",children:[n("div",{className:"label",children:e.title}),n("div",{className:"content",children:L}),e.pinned&&n(k,{className:"pinned"})]}),E("div",{className:"footer",children:[e.author," - ",y(e.timestamp)]})]},e.id)},R=()=>{var u,P,d;const e=N(s),r=N(p.APPS.AMBULANCE.permissions),[c,i]=C.useState(!1);C.useEffect(()=>{if(e){if(!(e!=null&&e.id)){s.set({id:e==null?void 0:e.id,title:a("APPS.POLICE.BULLETIN.NEW_BULLETIN"),content:"",author:"SYSTEM",timestamp:new Date().getTime()}),i(!0);return}i(!1)}},[e==null?void 0:e.id]);const L=()=>{if((e==null?void 0:e.title.length)<1||(e==null?void 0:e.content.length)<1)return m("error","Input or Textarea is empty");v("Ambulance",{action:"saveBulletin",data:{id:e.id,title:e.title,content:e.content}},e.id?!0:Math.random().toString(36).substring(7)).then(t=>{if(!t)return m("error","Failed to create / update bulletin");let o=e.id??(typeof t=="number"?t:Math.random());s.set({...s.value,id:o}),i(!1)})};return e?E(I.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.2},className:"active-bulletin",children:[E("div",{className:"top",children:[n("div",{className:"title",children:c?n(H,{value:e==null?void 0:e.title,onChange:t=>s.set({...e,title:t.target.value})}):e==null?void 0:e.title}),n("div",{className:"buttons",children:c?E(f,{children:[n("div",{className:"button",onClick:()=>{e!=null&&e.id?i(!1):s.set(null)},children:a("APPS.POLICE.CANCEL")}),(e==null?void 0:e.id)&&((u=r==null?void 0:r.bulletin)==null?void 0:u.pin)&&n("div",{className:x("button",(e==null?void 0:e.pinned)&&"red"),onClick:()=>z(e==null?void 0:e.id,!(e!=null&&e.pinned)),children:e!=null&&e.pinned?a("APPS.POLICE.HOME.UNPIN"):a("APPS.POLICE.HOME.PIN")}),n("div",{className:"button",onClick:L,children:e!=null&&e.id?a("APPS.POLICE.SAVE"):a("APPS.POLICE.CREATE")})]}):E(f,{children:[(((P=r==null?void 0:r.bulletin)==null?void 0:P.edit)||(e==null?void 0:e.created))&&n("div",{className:"button",onClick:()=>i(!c),children:a("APPS.POLICE.EDIT")}),(((d=r==null?void 0:r.bulletin)==null?void 0:d.delete)||(e==null?void 0:e.created))&&n("div",{className:"button red",onClick:()=>j(e==null?void 0:e.id),children:a("APPS.POLICE.DELETE")})]})})]}),n("div",{className:"items","data-overflow":"false",children:n(F,{id:`ambulance-bulletin-${e==null?void 0:e.id}`,liveEdit:!!(e!=null&&e.id),value:e==null?void 0:e.content,onChange:t=>s.set({...e,content:t}),editMode:c,height:"100%"})})]},(e==null?void 0:e.id)??"new"):null},j=e=>{var r;e&&(r=p.APPS.AMBULANCE.permissions.value)!=null&&r.bulletin.delete&&h.PopUp.set({title:a("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:a("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.DELETE"),color:"red",cb:()=>{v("Ambulance",{action:"deleteBulletin",id:e},!0).then(c=>{if(!c)return m("error","Failed to delete bulletin");s.set(null),l.set(l.value.filter(i=>i.id!==e))})}}]})},z=(e,r)=>{var c;e&&(c=p.APPS.AMBULANCE.permissions.value)!=null&&c.bulletin.pin&&v("Ambulance",{action:"toggleBulletinPinned",id:e,pinned:r},!0).then(i=>{var L;if(!i)return m("error","Failed to toggle pinned bulletin");l.set(l.value.map(u=>u.id===e?{...u,pinned:r}:u)),e===((L=s.value)==null?void 0:L.id)&&s.set({...s.value,pinned:r})})};export{s as SelectedBulletin,q as default};
