import{u as P,j as s,o as f,a as d,O as b,r as u,k as N,bw as g,J as E,L as c,bx as M,by as S,g as T,K as B,bu as I,aa as w,n as R,ay as D,bz as k,a1 as h,i as O}from"./index-BmPcK3sZ.js";import{SelectedBulletin as H}from"./Bulletin-B0GaMxbh.js";const U=b([]),A=b([]),v=b([]),y=(t,l)=>{switch(t){case"getReport":return g.reports.find(i=>i.id===l);default:return null}},_=(t,l)=>{if(!l)return E("error","No ID provided");N("Ambulance",{action:t,id:l},y(t,l)).then(i=>{if(!i)return E("error",`Failed to fetch  ${t} with ID: ${l}`);switch(t){case"getReport":M.set(i),S.set("reports");break}})};function $(){var l,i;const t=P(h.APPS.AMBULANCE.permissions);return s(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:s("main",{className:"main",style:{padding:"0"},children:d("div",{className:"grid",children:[((l=t==null?void 0:t.report)==null?void 0:l.view)!==!1&&s(x,{}),((i=t==null?void 0:t.bulletin)==null?void 0:i.view)!==!1&&s(F,{}),s(q,{})]})})})}const x=()=>{var p;const t=P(U),l=P(h.APPS.AMBULANCE.permissions),[i,n]=u.useState(""),[a,m]=u.useState("");return u.useEffect(()=>{const e=setTimeout(()=>n(a),500);return()=>clearTimeout(e)},[a]),u.useEffect(()=>{N("Ambulance",{action:"getReports",query:i},g.reports.filter(e=>{var r,o;return((r=e.title)==null?void 0:r.toLowerCase().includes(i==null?void 0:i.toLowerCase()))||((o=e.description)==null?void 0:o.toLowerCase().includes(i==null?void 0:i.toLowerCase()))})).then(e=>{if(!e)return E("warning","getReports did not return any data");U.set(e)})},[i]),d("div",{className:"grid-item full",children:[d("div",{className:"top",children:[s("div",{className:"title",children:c("APPS.AMBULANCE.HOME.RECENT_REPORTS")}),((p=l==null?void 0:l.report)==null?void 0:p.create)&&d("div",{className:"button",onClick:()=>{M.set({}),S.set("reports")},children:[s(T,{}),c("APPS.AMBULANCE.HOME.CREATE")]})]}),s(B,{placeholder:c("APPS.AMBULANCE.REPORTS.SEARCH"),onChange:e=>m(e.target.value)}),s("div",{className:"items",children:t.map(e=>{let r=e.description.replace(/[*#_\-\[\]\n]/g," "),o=r.split(" "),L="";for(let C=0;C<o.length&&!(L.length+o[C].length>150);C++)L+=o[C]+" ";return r.length>150&&(L+="..."),s(f.div,{...I,className:"item home",onClick:()=>_("getReport",e.id),children:d("div",{className:"item-content",children:[s("div",{className:"item-title",children:e.title}),s("div",{className:"item-subtitle",children:L}),s("div",{className:"item-footer",children:c("APPS.AMBULANCE.HOME.REPORT_FOOTER",{timestamp:w(e.lastUpdated),author:e.author})})]})},e.id)})})]})},F=()=>{var p;const t=P(A),l=P(h.APPS.AMBULANCE.permissions),[i,n]=u.useState(""),[a,m]=u.useState("");return u.useEffect(()=>{const e=setTimeout(()=>n(a),500);return()=>clearTimeout(e)},[a]),u.useEffect(()=>{N("Ambulance",{action:"getBulletinBoard",query:i},g.bulletinBoard.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.content.toLowerCase().includes(i.toLowerCase()))).then(e=>{if(!e)return E("warning","getBulletinBoard did not return any data");A.set(e)})},[i]),R("ambulance:bulletinDeleted",e=>{if(!e)return E("error","No ID provided in bulletinDeleted event");A.set(A.value.filter(r=>r.id!==e))}),d("div",{className:"grid-item full",children:[d("div",{className:"top",children:[s("div",{className:"title",children:c("APPS.POLICE.HOME.BULLETIN_BOARD")}),((p=l==null?void 0:l.bulletin)==null?void 0:p.create)&&d("div",{className:"button",onClick:()=>{H.set({}),S.set("bulletin")},children:[s(T,{}),c("APPS.POLICE.NEW")]})]}),s(B,{placeholder:c("APPS.POLICE.HOME.SEARCH_BULLETIN"),onChange:e=>m(e.target.value)}),s("div",{className:"items full",children:t.sort((e,r)=>e.timestamp===r.timestamp?0:e.timestamp>r.timestamp?-1:1).sort((e,r)=>e.pinned===r.pinned?0:e.pinned?-1:1).filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.content.toLowerCase().includes(i.toLowerCase())).map((e,r)=>s(j,{data:e},r))})]})},j=({data:t})=>{var a;const l=D(()=>{var m,p,e;!((m=h.APPS.AMBULANCE.permissions.value)!=null&&m.bulletin.pin)&&!(t!=null&&t.created)||O.ContextMenu.set({buttons:[((p=h.APPS.AMBULANCE.permissions.value)==null?void 0:p.bulletin.pin)&&{title:t.pinned?c("APPS.POLICE.HOME.UNPIN"):c("APPS.POLICE.HOME.PIN"),color:t.pinned?"red":null,cb:()=>{N("Ambulance",{action:"toggleBulletinPinned",id:t.id,pinned:!t.pinned},!0).then(r=>{if(!r)return E("error","Failed to toggle pinned bulletin");A.set(A.value.map(o=>o.id===t.id?{...o,pinned:!o.pinned}:o))})}},(t.created||((e=h.APPS.AMBULANCE.permissions.value)==null?void 0:e.bulletin.delete))&&{title:c("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{O.PopUp.set({title:c("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:c("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:c("APPS.POLICE.CANCEL")},{title:c("APPS.POLICE.DELETE"),color:"red",cb:()=>{N("Ambulance",{action:"deleteBulletin",id:t.id},!0).then(r=>{if(!r)return E("error","Failed to delete bulletin");A.set(A.value.filter(o=>o.id!==t.id))})}}]})}}]})});let i=(a=t.content)==null?void 0:a.replace(/[*#_\-\[\]\n]/g," "),n=(i==null?void 0:i.length)>75?(i==null?void 0:i.slice(0,75))+"...":i;return s(f.div,{...I,...l,className:"item home",onClick:()=>{H.set(t),S.set("bulletin")},children:d("div",{className:"item-content",children:[t.pinned&&s(k,{}),s("div",{className:"item-title",children:t.title}),s("div",{className:"item-subtitle",children:n}),d("div",{className:"item-footer",children:[w(t.timestamp)," - ",t.author]})]})})},q=()=>{const t=P(v),[l,i]=u.useState("");return u.useEffect(()=>{N("Ambulance",{action:"getActiveUnits"},g.activeUnits).then(n=>{if(!n)return E("warning","getActiveUnits did not return any data");v.set(n)})},[]),R("ambulance:updateCallsign",n=>{if(!n)return E("error","No data received for ambulance:updateCallsign");v.set(v.value.map(a=>a.source===n.source?{...a,callsign:n.callsign}:a))}),d("div",{className:"grid-item full",children:[s("div",{className:"top",children:s("div",{className:"title",children:c("APPS.AMBULANCE.HOME.ACTIVE_UNITS")})}),s(B,{placeholder:c("APPS.AMBULANCE.HOME.SEARCH_UNITS"),onChange:n=>i(n.target.value)}),s("div",{className:"items full",children:t.filter(n=>{var a,m;return((a=n==null?void 0:n.callsign)==null?void 0:a.toLowerCase().includes(l.toLowerCase()))||((m=n==null?void 0:n.name)==null?void 0:m.toLowerCase().includes(l==null?void 0:l.toLowerCase()))}).map((n,a)=>d(f.div,{...I,className:"item unit",children:[n.callsign&&s("div",{className:"card green tabular",children:n.callsign}),s("div",{className:"card red",children:n.rank}),s("div",{className:"name",children:n.name})]},a))})]})};export{$ as default};
