import{u as r,r as x,W as $,bd as p,k as C,be as j,j as i,a as v,a$ as U,bf as M,bg as B,bh as G,b0 as W,bi as Y,b1 as z,bj as F,L as q,O as T,aC as D,J as y,n as J,S as V,bk as H,bl as K,bm as Q,bn as X,bo as g,h as ee,P as oe}from"./index-BmPcK3sZ.js";const L=T(g.LOS_SANTOS),b=T(localStorage.getItem("lb-active-map-type")??M.mapStyles.render),d=T([0,0]);function pe(){var A,_,I,N,O;const e=r(ee),n=(A=r(oe))==null?void 0:A.active,o=r(L),a=r(b),[l,f]=x.useState([]);x.useEffect(()=>{if(!$("Maps")||!(e!=null&&e.Locations)&&!(n!=null&&n.data))return;(async()=>{var P,Z,k,w;const c=(n==null?void 0:n.data)&&{position:(P=n.data)==null?void 0:P.location,name:(Z=n.data)==null?void 0:Z.name,icon:(k=n.data)==null?void 0:k.icon,description:(w=n.data)==null?void 0:w.description,size:[35,35]},u=[];let E=0;if(!(e!=null&&e.Locations)||e.Locations.length===0)return f([c]);e==null||e.Locations.forEach(m=>{D(m.icon,R=>{u.push({position:[m.position.y,m.position.x],name:m.name,description:m.description,icon:R?m.icon:"./assets/img/icons/maps/mappin.png"}),E++,E===e.Locations.length&&f([c,...u].filter(Boolean))})})})()},[e,n]),x.useEffect(()=>{if((window==null?void 0:window.chrome)!==void 0){const s=p.GridLayer.prototype._initTile;p.GridLayer.include({_initTile:function(c){s.call(this,c);const u=this.getTileSize();c.style.width=`${u.x+1}px`,c.style.height=`${u.y+1}px`}})}return C("Maps",{action:"toggleUpdateCoords",toggle:!0}),()=>{C("Maps",{action:"toggleUpdateCoords"})}},[]);const h=s=>{if(!s)return y("warning","No data provided to setWaypoint");y("info","Setting waypoint to",s),C("Maps",{action:"setWaypoint",coords:{x:s[1],y:s[0]}})},t=M.mapTypes[o],S=j(o);return i("div",{className:"maps-container",children:i("div",{className:"map-wrapper",children:v(U,{className:"map",style:{backgroundColor:M.backgrounds[a]},crs:o==="losSantos"?B:G,center:[((_=d.value)==null?void 0:_[0])||((I=t==null?void 0:t.defaultCenter)==null?void 0:I[0]),((N=d.value)==null?void 0:N[1])||((O=t==null?void 0:t.defaultCenter)==null?void 0:O[1])],zoom:t.initialZoom,minZoom:t.minZoom,maxZoom:t.maxZoom,bounceAtZoomLimits:!0,maxBoundsViscosity:.95,maxBounds:S,preferCanvas:!0,zoomControl:!1,attributionControl:!1,boxZoom:!1,children:[i(te,{}),i(W,{url:Y[o].tileServer.replace("{layer}",a),minZoom:t.minZoom,maxZoom:t.maxZoom,maxNativeZoom:t.maxZoom,noWrap:!0},`${o}-${a}`),l.map((s,c)=>s?i(z,{position:s.position,icon:se(s.icon),children:i(F,{children:v("div",{className:"location-popup",children:[i("div",{className:"name",children:s.name}),i("div",{className:"description",children:s.description}),i("div",{className:"button",onClick:()=>h(s.position),children:q("APPS.MAPS.GO")})]})})},c):null),i(ne,{})]},`map-${o}-${a}`)})})}const ne=()=>{const e=r(d);J("maps:updateCoords",o=>{var a;if(!o)return y("warning","Received empty data from maps:updateCoords");if(!((o==null?void 0:o.x)===e[1]&&(o==null?void 0:o.y)===e[0])){if((a=V.value)!=null&&a.airplaneMode)return y("info","Airplane mode is enabled, can't update coords");d.set([o.y,o.x])}});const n=new p.Icon({iconUrl:"./assets/img/icons/maps/pin.svg",popupAnchor:[-0,-0],iconSize:[30,30]});return!e.includes(0,1)&&i(z,{position:e,icon:n})},te=()=>{const e=H(),n=r(d),o=r(b),a=r(L),l=["render","game","print"],f=()=>{const S=(l.indexOf(o)+1)%l.length;b.set(l[S]),localStorage.setItem("lb-active-map-type",l[S])},h=()=>{const t=a===g.LOS_SANTOS?g.CAYO_PERICO:g.LOS_SANTOS;L.set(t)};return v("div",{className:"options",children:[i(K,{onClick:()=>f()}),i(Q,{onClick:()=>h()}),i(X,{onClick:()=>e.panTo(n)})]})},se=(e,n)=>new p.Icon({iconUrl:e??"./assets/img/icons/maps/mappin.png",popupAnchor:[-0,-0],iconSize:n??[25,25]}),ie=117.3,ae=172.8,ce=.02072,le=p.extend({},p.CRS.Simple,{projection:p.Projection.LonLat,scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/.6931471805599453},distance:function(e,n){var o=n.lng-e.lng,a=n.lat-e.lat;return Math.sqrt(o*o+a*a)},transformation:new p.Transformation(ce,ie,-.0205,ae),infinite:!0});export{L as ActiveMapType,le as CUSTOM_CRS,pe as default,se as generateIcon};
