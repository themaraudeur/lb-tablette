import{u as h,r as v,k as I,bH as A,J as L,n as N,bA as g,j as n,o as f,a as E,L as r,g as T,K as D,ag as M,O,ay as U,bu as w,bz as k,bB as H,I as y,F as b,bs as x,bC as F,a1 as C,i as S}from"./index-BmPcK3sZ.js";const l=O([]),a=O(null);function q(){var d;const e=h(l),o=h(a),c=h(C.APPS.POLICE.permissions),[i,p]=v.useState(""),[P,u]=v.useState("");return v.useEffect(()=>{I("Police",{action:"getBulletinBoard",query:i},A.bulletinBoard.filter(t=>t.title.toLowerCase().includes(i.toLowerCase())||t.content.toLowerCase().includes(i.toLowerCase()))).then(t=>{if(!t)return L("warning","getBulletinBoard did not return any data");l.set(t)})},[i]),N("police:bulletinCreated",t=>{var s;if(!t)return L("error","No data provided in bulletinCreated event");l.set([{...t,created:t.createdBy===((s=g.value)==null?void 0:s.id)},...l.value])}),N("police:bulletinUpdated",t=>{if(!t)return L("error","No data provided in bulletinUpdated event");l.set(l.value.map(s=>s.id===t.id?{...s,title:t.title,content:t.content,timestamp:new Date().getTime()}:s))}),N("police:bulletinDeleted",t=>{var s;if(!t)return L("error","No ID provided in bulletinDeleted event");l.set(l.value.filter(m=>m.id!==t)),t===((s=a.value)==null?void 0:s.id)&&a.set(null)}),v.useEffect(()=>{const t=setTimeout(()=>p(P),500);return()=>clearTimeout(t)},[P]),n(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:E("main",{className:"main bulletins",children:[E("div",{className:"chats bulletin",children:[E("div",{className:"top",children:[n("div",{className:"title",children:r("APPS.POLICE.BULLETIN.LABEL")}),n("div",{className:"buttons",children:((d=c==null?void 0:c.bulletin)==null?void 0:d.create)&&E("div",{className:"button",onClick:()=>a.set({}),children:[n(T,{}),r("APPS.POLICE.NEW")]})})]}),n(D,{placeholder:r("APPS.POLICE.BULLETIN.SEARCH"),onChange:t=>u(t.target.value)}),n("div",{className:"items",children:e.sort((t,s)=>t.timestamp>s.timestamp?-1:1).sort((t,s)=>t.pinned===s.pinned?0:t.pinned?-1:1).filter(t=>t.title.toLowerCase().includes(i.toLowerCase())||t.content.toLowerCase().includes(i.toLowerCase())).map(t=>n(_,{data:t},t.id))})]}),n("div",{className:"bulletin active",children:n(M,{children:o&&n(R,{})})})]})})}const _=({data:e})=>{var P;const o=U(()=>{var u,d,t;!((u=C.APPS.POLICE.permissions.value)!=null&&u.bulletin.pin)&&!(e!=null&&e.created)||S.ContextMenu.set({buttons:[((d=C.APPS.POLICE.permissions.value)==null?void 0:d.bulletin.pin)&&{title:e.pinned?r("APPS.POLICE.HOME.UNPIN"):r("APPS.POLICE.HOME.PIN"),color:e.pinned?"red":null,cb:()=>{I("Police",{action:"toggleBulletinPinned",id:e.id,pinned:!e.pinned},!0).then(s=>{if(!s)return L("error","Failed to toggle pinned bulletin");l.set(l.value.map(m=>m.id===e.id?{...m,pinned:!m.pinned}:m))})}},(e.created||((t=C.APPS.POLICE.permissions.value)==null?void 0:t.bulletin.delete))&&{title:r("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{S.PopUp.set({title:r("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:r("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.DELETE"),color:"red",cb:()=>{I("Police",{action:"deleteBulletin",id:e.id},!0).then(s=>{if(!s)return L("error","Failed to delete bulletin");l.set(l.value.filter(m=>m.id!==e.id))})}}]})}}]})}),c=u=>{var d;if(u.id===((d=a.value)==null?void 0:d.id))return a.set(null);a.set(u)};let i=(P=e==null?void 0:e.content)==null?void 0:P.replace(/[*#_\-\[\]\n]/g," "),p=(i==null?void 0:i.length)>75?(i==null?void 0:i.slice(0,75))+"...":i;return E(f.div,{...o,...w,className:"item bulletin-item",onClick:()=>c(e),children:[E("div",{className:"info",children:[n("div",{className:"label",children:e.title}),n("div",{className:"content",children:p}),e.pinned&&n(k,{className:"pinned"})]}),E("div",{className:"footer",children:[e.author," - ",H(e.timestamp)]})]},e.id)},R=()=>{var P,u,d;const e=h(a),o=h(C.APPS.POLICE.permissions),[c,i]=v.useState(!1);v.useEffect(()=>{if(e){if(!(e!=null&&e.id)){a.set({id:e==null?void 0:e.id,title:r("APPS.POLICE.BULLETIN.NEW_BULLETIN"),content:"",author:"SYSTEM",timestamp:new Date().getTime()}),i(!0);return}i(!1)}},[e==null?void 0:e.id]);const p=()=>{if((e==null?void 0:e.title.length)<1||(e==null?void 0:e.content.length)<1)return L("error","Input or Textarea is empty");I("Police",{action:"saveBulletin",data:{id:e.id,title:e.title,content:e.content}},Math.random().toString(36).substring(7)).then(t=>{if(!t)return L("error","Failed to create / update bulletin");a.set({...a.value,id:t}),i(!1)})};return e?E(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.2},className:"active-bulletin",children:[E("div",{className:"top",children:[n("div",{className:"title",children:c?n(y,{value:e==null?void 0:e.title,onChange:t=>a.set({...e,title:t.target.value})}):e==null?void 0:e.title}),n("div",{className:"buttons",children:c?E(b,{children:[n("div",{className:"button",onClick:()=>{e!=null&&e.id?i(!1):a.set(null)},children:r("APPS.POLICE.CANCEL")}),(e==null?void 0:e.id)&&((P=o==null?void 0:o.bulletin)==null?void 0:P.pin)&&n("div",{className:x("button",(e==null?void 0:e.pinned)&&"red"),onClick:()=>z(e==null?void 0:e.id,!(e!=null&&e.pinned)),children:e!=null&&e.pinned?r("APPS.POLICE.HOME.UNPIN"):r("APPS.POLICE.HOME.PIN")}),n("div",{className:"button",onClick:p,children:e!=null&&e.id?r("APPS.POLICE.SAVE"):r("APPS.POLICE.CREATE")})]}):E(b,{children:[(((u=o==null?void 0:o.bulletin)==null?void 0:u.edit)||(e==null?void 0:e.created))&&n("div",{className:"button",onClick:()=>i(!c),children:r("APPS.POLICE.EDIT")}),(((d=o==null?void 0:o.bulletin)==null?void 0:d.delete)||(e==null?void 0:e.created))&&n("div",{className:"button red",onClick:()=>j(e==null?void 0:e.id),children:r("APPS.POLICE.DELETE")})]})})]}),n("div",{className:"items","data-overflow":"false",children:n(F,{id:`police-bulletin-${e==null?void 0:e.id}`,liveEdit:!!(e!=null&&e.id),value:e==null?void 0:e.content,onChange:t=>a.set({...e,content:t}),editMode:c,height:"100%"})})]},(e==null?void 0:e.id)??"new"):null},j=e=>{var o;e&&(o=C.APPS.POLICE.permissions.value)!=null&&o.bulletin.delete&&S.PopUp.set({title:r("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:r("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.DELETE"),color:"red",cb:()=>{I("Police",{action:"deleteBulletin",id:e},!0).then(c=>{if(!c)return L("error","Failed to delete bulletin");a.set(null),l.set(l.value.filter(i=>i.id!==e))})}}]})},z=(e,o)=>{var c;e&&(c=C.APPS.POLICE.permissions.value)!=null&&c.bulletin.pin&&I("Police",{action:"toggleBulletinPinned",id:e,pinned:o},!0).then(i=>{var p;if(!i)return L("error","Failed to toggle pinned bulletin");l.set(l.value.map(P=>P.id===e?{...P,pinned:o}:P)),e===((p=a.value)==null?void 0:p.id)&&a.set({...a.value,pinned:o})})};export{a as SelectedBulletin,q as default};
