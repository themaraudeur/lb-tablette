import{a as b,j as s,Q as X,r as d,R as Y,I as K,L as F,u as E,F as te,U as re,J as S,k as ne,V as oe,W as se,h as O,X as D,g as ie,Y as ae,Z as ce,_ as le,$ as ue,a0 as de,O as x,P as fe}from"./index-BmPcK3sZ.js";function me({data:e}){return b("div",{className:"bookmark-wrapper",onMouseUp:n=>W(e.url),children:[s(he,{icon:e==null?void 0:e.icon}),s("div",{className:"title",children:e.title})]})}const he=({icon:e})=>e?s("img",{src:e}):s(X,{});function ve({active:e}){const[n,r]=d.useState("");return s("div",{className:"empty-tab","data-active":e,children:b("div",{className:"empty-tab-content",children:[s("img",{className:"logo",src:"./assets/img/logo.png"}),b("div",{className:"searchbar",children:[s(Y,{}),s(K,{type:"text",placeholder:F("APPS.BROWSER.SEARCH_PLACEHOLDER"),value:n,onChange:a=>r(a.target.value),onKeyUp:a=>a.key==="Enter"&&W(a.currentTarget.value)})]})]})})}function pe({data:e,active:n,addRef:r}){const a=E(w),[c,p]=d.useState(!1),[f,i]=d.useState(null),m=d.useRef(),y=d.useRef(!0);return d.useEffect(()=>{f&&(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{f&&Q(e.id,f,y.current),y.current&&(y.current=!1)},250))},[f]),d.useEffect(()=>{p(!1)},[e==null?void 0:e.id,a]),s(te,{children:c?b("div",{className:"failed-load",children:[s(re,{}),s("div",{className:"subtitle",children:F("APPS.BROWSER.FAILED_LOAD_PAGE")})]}):s("iframe",{ref:T=>r(T),src:e.url,title:e.title,"data-active":n,onLoad:async T=>{await new Promise(h=>setTimeout(h,100));const A=T.target,l=A.contentDocument;if(!l)return S("warning","Failed to load iframe",e.url);if((l==null?void 0:l.head.childElementCount)===0&&n){S("warning","Failed to load iframe"),p(!0);return}i(h=>{var I;return{...h,title:l.title,icon:(I=l.querySelector("link[rel='icon']"))==null?void 0:I.href}}),l.querySelector("title")&&new MutationObserver(I=>{i(g=>({...g,title:l.title}))}).observe(l.querySelector("title"),{subtree:!0,characterData:!0,childList:!0}),A.contentWindow.navigation.addEventListener("navigate",h=>{i(I=>({...I,url:h.destination.url}))}),l.onmouseup=h=>{if(h.button!==0&&h.button!==1)return;const I=l.elementsFromPoint(h.clientX,h.clientY);for(const g of I)if((g==null?void 0:g.tagName)==="A"&&((g==null?void 0:g.target)==="_blank"||h.button===1)){let R=g.href;h.preventDefault(),P(R)}},A.contentWindow.fetchNui=ne;const C=l.createElement("script");C.innerHTML=`
                    let addedHandlers = [];

                    function refreshInputs(inputs) {
                        inputs.forEach((input) => {
                            if (addedHandlers.includes(input)) return console.log('already added handler for', input);

                            input.addEventListener('focus', () => fetchNui('toggleInput', true, 'ok'));
                            input.addEventListener('blur', () => fetchNui('toggleInput', false, 'ok'));
                        });
                    }

                    refreshInputs(document.querySelectorAll('input, textarea'));

                    const inputObserver = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            mutation.addedNodes.forEach((node) => {
                                if (node.childNodes.length > 0) refreshInputs(node.querySelectorAll('input, textarea'));
                                if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') refreshInputs([node]);
                            });
                        });
                    });

                    inputObserver.observe(document.body, { childList: true, subtree: true });
                `,l.body.appendChild(C)}})})}function ge({data:e}){const[n,r]=d.useState(w.value===e.id),a=E(w);return d.useEffect(()=>{r(e.id===w.value)},[a]),b("div",{className:"tab-wrapper","data-active":n,onClick:()=>w.set(e.id),onMouseUp:c=>{c.button===1&&$(e.id)},children:[b("div",{className:"tab-content",children:[s(be,{data:e}),s("div",{className:"title",children:e.title})]}),s(oe,{onClick:c=>{c.stopPropagation(),$(e.id)}})]})}function be({data:e}){return e!=null&&e.icon?s("img",{src:e.icon,onError:n=>{e.id&&Q(e.id,{icon:void 0})}}):s(X,{})}const U={tabs:[{id:"1",title:"LB",url:"https://lbscripts.com"}],bookmarks:[{id:"1",title:"LB",url:"https://lbscripts.com"},{id:"2",title:"Yep",url:"https://www.yep.com"}]},v=x([]).mock(U.tabs),M=localStorage.getItem(`${D.value}-lb-tablet:bookmarks`),ke=M?JSON.parse(M):[];var J,j;const w=x(null).mock((j=(J=U.tabs)==null?void 0:J[0])==null?void 0:j.id),N=x(ke).mock(U.bookmarks),k=x({}),G=localStorage.getItem(`${D.value}-lb-tablet:browserHistory`),V=x(G?JSON.parse(G):[]);function Ie(){var g,R;const e=d.useRef([]),n=E(v),r=E(w),a=E(N),c=(g=E(fe))==null?void 0:g.active,[p,f]=d.useState(""),[i,m]=d.useState(!1),[y,T]=d.useState(!1),[A,l]=d.useState(!1),_=t=>{if(t=t??n.find(u=>u.id===r),!(t!=null&&t.url))return;let o=[...N.value,t];N.set(o),localStorage.setItem(`${D.value}-lb-tablet:bookmarks`,JSON.stringify(o)),l(!0)},C=()=>{const t=e.current[r],o=k.value[r];if(!t||!o)return S("warning","No iframe / history found");const u=o.currentIndex;if(u===0)return S("warning","Already at first page");t.src=o.history[u-1],o.currentIndex=u-1,k.patch({[r]:o})},h=()=>{const t=e.current[r],o=k.value[r];if(!t||!o)return S("warning","No iframe / history found");const u=o.currentIndex;if(u===o.history.length-1)return S("warning","Already at last page");t.src=o.history[u+1],o.currentIndex=u+1,k.patch({[r]:o})},I=()=>{var o;const t=e.current[r];t&&((o=t.contentWindow)==null||o.location.reload())};return d.useEffect(()=>{var t;if(se("Browser"))return v.value.length===0&&P(),N.set([...((t=O.value.Browser)==null?void 0:t.DefaultBookmarks)??[],...N.value.filter(o=>{var q,z;let u=!o.id,L=u&&!((z=(q=O.value.Browser)==null?void 0:q.DefaultBookmarks)!=null&&z.find(H=>H.url===o.url)),B=u&&N.value.find(H=>H.url===o.url);return!L&&!B})]),()=>{let o=V.value;localStorage.setItem(`${D.value}-lb-tablet:browserHistory`,JSON.stringify(o))}},[c]),d.useEffect(()=>{var o,u,L;const t=v.value.find(B=>B.id===w.value);t&&(m(((o=k.value[r])==null?void 0:o.currentIndex)!==0),T(((u=k.value[r])==null?void 0:u.currentIndex)!==((L=k.value[r])==null?void 0:L.history.length)-1)),f((t==null?void 0:t.url)??""),l(!!N.value.find(B=>B.url===(t==null?void 0:t.url)))},[r,n]),b("div",{className:"browser-container",children:[b("div",{className:"browser-header",children:[b("div",{className:"tab-container",children:[n.map((t,o)=>s(ge,{data:t},o)),s("div",{className:"tab-add",children:s(ie,{onClick:()=>P()})})]}),b("div",{className:"search-container",children:[b("div",{className:"actions",children:[s(ae,{"data-disabled":!i,onClick:C}),s(ce,{"data-disabled":!y,onClick:h}),s(le,{"data-disabled":!r,onClick:I})]}),b("div",{className:"searchbar",children:[s(Y,{}),s(K,{type:"text",value:p,placeholder:((R=n.find(t=>t.id===r))==null?void 0:R.url)??F("APPS.BROWSER.SEARCH_PLACEHOLDER"),onFocusCapture:t=>t.currentTarget.select(),onKeyUp:t=>{t.key==="Enter"&&W(t.currentTarget.value)},onChange:t=>f(t.currentTarget.value)}),A?s(ue,{className:"bookmark","data-disabled":!r,onClick:()=>{N.set(N.value.filter(t=>t.url!==p)),l(!1)}}):s(de,{className:"bookmark","data-disabled":!r,onClick:()=>_()})]})]}),s("div",{className:"bookmark-container",children:a.map((t,o)=>s(me,{data:t},o))})]}),s("div",{className:"browser-content",children:n.map((t,o)=>t.url?s(pe,{data:t,active:t.id===r,addRef:u=>e.current[t.id]=u},t.id):s(ve,{active:t.id===r},t.id))})]})}const we=e=>{if(!e)return S("warning","No data provided to add to long history, returning");V.push({icon:e.icon,title:e.title,link:e.url,date:Date.now()})},W=e=>{if(e&&(e=Z(e)?e:"https://yep.com/web?q="+encodeURIComponent(e)),!ee(e))return S("warning","Website not allowed");const n=w.value;v.set([...v.value.map(r=>r.id===n?{...r,url:e}:r)])},P=e=>{if(e&&(e=Z(e)?e:"https://yep.com/web?q="+encodeURIComponent(e)),!ee(e))return S("warning","Website not allowed");const n=crypto.randomUUID(),r={id:n,url:e,title:e??"New Tab"};k.patch({[n]:{history:[e],currentIndex:0}}),v.push(r),w.set(n)},$=e=>{var n,r;if(v.value.length===1&&P(),w.value===e){const a=v.value.findIndex(p=>p.id===e),c=((n=v.value[a+1])==null?void 0:n.id)??((r=v.value[a-1])==null?void 0:r.id);w.set(c)}v.set([...v.value.filter(a=>a.id!==e)]),k.patch({[e]:void 0})},Q=(e,n,r)=>{let a=r===!0,{title:c,icon:p,link:f}=n;const i=v.value.find(m=>m.id===e);if(i){if(c&&(c.length>20&&(c=c.substring(0,20)+"..."),i&&i.title!==c&&(i.title=c)),p&&(i==null?void 0:i.icon)!==p&&(i.icon=p),f&&(i==null?void 0:i.url)!==f){i.url=f;const m=k.value[e].history;k.patch({[e]:{history:[...m,f],currentIndex:m.length}}),a=!0}a&&we(i),v.set([...v.value.filter(m=>m.id!==e),i])}},Z=e=>e?new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e):!1,ee=e=>{var a,c,p,f,i,m;let n=(p=(c=(a=O)==null?void 0:a.value)==null?void 0:c.Browser)==null?void 0:p.BlacklistedDomains,r=(m=(i=(f=O)==null?void 0:f.value)==null?void 0:i.Browser)==null?void 0:m.WhitelistedDomains;return!e||!n||!r?!0:(n==null?void 0:n.length)>0&&n.some(y=>e.includes(y))?!1:(r==null?void 0:r.length)===0?!0:r.some(y=>e.includes(y))};export{w as ActiveTab,N as Bookmarks,V as LongHistory,k as TabHistory,v as Tabs,P as addTab,Ie as default,$ as removeTab,W as setTab,Q as updateTabData};
