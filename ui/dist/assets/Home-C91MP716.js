import{u as p,j as s,o as S,a as o,O as A,r as d,k as v,bH as N,J as P,L as a,bI as B,bJ as f,g as R,K as I,bu as b,aa as T,n as U,ay as _,bz as W,bK as D,a1 as g,i as w,bL as x}from"./index-BmPcK3sZ.js";import{SelectedBulletin as M}from"./Bulletin-CpJ0Ais3.js";const H=A([]),L=A([]),k=A([]),O=A([]),F=(t,n)=>{switch(t){case"getReport":return N.reports.find(i=>i.id===n);case"getWarrant":return N.warrants.find(i=>i.id===n);default:return null}},y=(t,n)=>{if(!n)return P("error","No ID provided");v("Police",{action:t,id:n},F(t,n)).then(i=>{if(!i)return P("error",`Failed to fetch ${t} with ID: ${n}`);switch(t){case"getReport":B.set(i),f.set("reports");break;case"getWarrant":D.set(i),f.set("warrants");break;default:P("error",`Unknown event: ${t}`);break}})};function G(){var n,i,r;const t=p(g.APPS.POLICE.permissions);return s(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:s("main",{className:"main",style:{padding:"0"},children:o("div",{className:"grid",children:[((n=t==null?void 0:t.report)==null?void 0:n.view)!==!1&&s(j,{}),((i=t==null?void 0:t.bulletin)==null?void 0:i.view)!==!1&&s(q,{}),s(J,{}),((r=t==null?void 0:t.warrant)==null?void 0:r.view)!==!1&&s(z,{})]})})})}const j=()=>{var m;const t=p(H),n=p(g.APPS.POLICE.permissions),[i,r]=d.useState(""),[l,C]=d.useState("");return d.useEffect(()=>{const e=setTimeout(()=>r(l),500);return()=>clearTimeout(e)},[l]),d.useEffect(()=>{v("Police",{action:"getReports",query:i},N.reports.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()))).then(e=>{if(!e)return P("warning","getReports did not return any data");H.set(e)})},[i]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[s("div",{className:"title",children:a("APPS.POLICE.HOME.RECENT_REPORTS")}),((m=n==null?void 0:n.report)==null?void 0:m.create)&&o("div",{className:"button",onClick:()=>{B.set({}),f.set("reports")},children:[s(R,{}),a("APPS.POLICE.HOME.CREATE")]})]}),s(I,{placeholder:a("APPS.POLICE.REPORTS.SEARCH"),onChange:e=>C(e.target.value)}),s("div",{className:"items",children:t.map(e=>{let c=e.description.replace(/[*#_\-\[\]\n]/g," "),u=c.split(" "),h="";for(let E=0;E<u.length&&!(h.length+u[E].length>100);E++)h+=u[E]+" ";return c.length>100&&(h+="..."),s(S.div,{...b,className:"item home",onClick:()=>y("getReport",e.id),children:o("div",{className:"item-content",children:[s("div",{className:"item-title",children:e.title}),s("div",{className:"item-subtitle",children:h}),s("div",{className:"item-footer",children:a("APPS.POLICE.HOME.REPORT_FOOTER",{timestamp:T(e.lastUpdated),author:e.author})})]})},e.id)})})]})},q=()=>{var m;p(x);const t=p(L),n=p(g.APPS.POLICE.permissions),[i,r]=d.useState(""),[l,C]=d.useState("");return d.useEffect(()=>{const e=setTimeout(()=>r(l),500);return()=>clearTimeout(e)},[l]),d.useEffect(()=>{v("Police",{action:"getBulletinBoard",query:i},N.bulletinBoard.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.content.toLowerCase().includes(i.toLowerCase()))).then(e=>{if(!e)return P("warning","getBulletinBoard did not return any data");L.set(e)})},[i]),U("police:bulletinDeleted",e=>{if(!e)return P("error","No ID provided in bulletinDeleted event");L.set(L.value.filter(c=>c.id!==e))}),o("div",{className:"grid-item full",children:[o("div",{className:"top",children:[s("div",{className:"title",children:a("APPS.POLICE.HOME.BULLETIN_BOARD")}),((m=n==null?void 0:n.bulletin)==null?void 0:m.create)&&o("div",{className:"button",onClick:()=>{M.set({}),f.set("bulletin")},children:[s(R,{}),a("APPS.POLICE.NEW")]})]}),s(I,{placeholder:a("APPS.POLICE.HOME.SEARCH_BULLETIN"),onChange:e=>C(e.target.value)}),s("div",{className:"items full",children:t.sort((e,c)=>e.timestamp===c.timestamp?0:e.timestamp>c.timestamp?-1:1).sort((e,c)=>e.pinned===c.pinned?0:e.pinned?-1:1).filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.content.toLowerCase().includes(i.toLowerCase())).map((e,c)=>s($,{data:e},c))})]})},$=({data:t})=>{var l;const n=_(()=>{var C,m,e;!((C=g.APPS.POLICE.permissions.value)!=null&&C.bulletin.pin)&&!(t!=null&&t.created)||w.ContextMenu.set({buttons:[((m=g.APPS.POLICE.permissions.value)==null?void 0:m.bulletin.pin)&&{title:t.pinned?a("APPS.POLICE.HOME.UNPIN"):a("APPS.POLICE.HOME.PIN"),color:t.pinned?"red":null,cb:()=>{v("Police",{action:"toggleBulletinPinned",id:t.id,pinned:!t.pinned},!0).then(c=>{if(!c)return P("error","Failed to toggle pinned bulletin");L.set(L.value.map(u=>u.id===t.id?{...u,pinned:!u.pinned}:u))})}},(t.created||((e=g.APPS.POLICE.permissions.value)==null?void 0:e.bulletin.delete))&&{title:a("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{w.PopUp.set({title:a("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:a("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.DELETE"),color:"red",cb:()=>{v("Police",{action:"deleteBulletin",id:t.id},!0).then(c=>{if(!c)return P("error","Failed to delete bulletin");L.set(L.value.filter(u=>u.id!==t.id))})}}]})}}]})});let i=(l=t.content)==null?void 0:l.replace(/[*#_\-\[\]\n]/g," "),r=(i==null?void 0:i.length)>75?(i==null?void 0:i.slice(0,75))+"...":i;return s(S.div,{...b,...n,className:"item home",onClick:()=>{M.set(t),f.set("bulletin")},children:o("div",{className:"item-content",children:[t.pinned&&s(W,{}),s("div",{className:"item-title",children:t.title}),s("div",{className:"item-subtitle",children:r}),o("div",{className:"item-footer",children:[T(t.timestamp)," - ",t.author]})]})})},z=()=>{var m;const t=p(k),n=p(g.APPS.POLICE.permissions),[i,r]=d.useState(""),[l,C]=d.useState("");return d.useEffect(()=>{const e=setTimeout(()=>r(l),500);return()=>clearTimeout(e)},[l]),d.useEffect(()=>{v("Police",{action:"getWarrants",query:i},N.warrants.filter(e=>e.title.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase()))).then(e=>{if(!e)return P("warning","getReports did not return any data");k.set(e)})},[i]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[s("div",{className:"title",children:a("APPS.POLICE.HOME.RECENT_WARRANTS")}),((m=n==null?void 0:n.warrant)==null?void 0:m.create)&&o("div",{className:"button",onClick:()=>{D.set({}),f.set("warrants")},children:[s(R,{}),a("APPS.POLICE.HOME.CREATE")]})]}),s(I,{placeholder:a("APPS.POLICE.WARRANTS.SEARCH"),onChange:e=>C(e.target.value)}),s("div",{className:"items",children:t.map(e=>{let c=e.description.replace(/[*#_\-\[\]]/g," "),u=c.split(" "),h="";for(let E=0;E<u.length&&!(h.length+u[E].length>100);E++)h+=u[E]+" ";return c.length>100&&(h+="..."),d.createElement(S.div,{...b,key:e.id,className:"item home",onClick:()=>{y("getWarrant",e.id)}},o("div",{className:"item-content",children:[s("div",{className:"item-title",children:e.title}),s("div",{className:"item-subtitle",children:h}),o("div",{className:"item-footer",children:[T(e.lastUpdated)," - ",e.author]})]}))})})]})},J=()=>{const t=p(O),[n,i]=d.useState("");return d.useEffect(()=>{v("Police",{action:"getActiveUnits"},N.activeUnits).then(r=>{if(!r)return P("warning","getActiveUnits did not return any data");O.set(r)})},[]),U("police:updateCallsign",r=>{if(!r)return P("error","No data received for police:updateCallsign");O.set(O.value.map(l=>l.source===r.source?{...l,callsign:r.callsign}:l))}),o("div",{className:"grid-item full",children:[s("div",{className:"top",children:s("div",{className:"title",children:a("APPS.POLICE.HOME.ACTIVE_UNITS")})}),s(I,{placeholder:a("APPS.POLICE.HOME.SEARCH_UNITS"),onChange:r=>i(r.target.value)}),s("div",{className:"items full",children:t.filter(r=>{var l;return((l=r==null?void 0:r.callsign)==null?void 0:l.toLowerCase().includes(n.toLowerCase()))||(r==null?void 0:r.name.toLowerCase().includes(n.toLowerCase()))}).map((r,l)=>o(S.div,{...b,className:"item unit",children:[r.callsign&&s("div",{className:"card green tabular",children:r.callsign}),s("div",{className:"card blue",children:r.rank}),s("div",{className:"name",children:r.name})]},l))})]})};export{G as default};
