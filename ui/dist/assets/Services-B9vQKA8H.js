import{u as v,r as p,W as Y,k as E,J as C,j as e,F as y,a as s,L as n,o as g,aW as te,b as z,aX as ne,aY as ie,i as f,aZ as se,g as ce,a_ as oe,h as H,a$ as le,b0 as re,b1 as de,a2 as K,n as D,N as me,b2 as V,b3 as Se,I as ue,b4 as F,b5 as Pe,aj as J,b6 as Ee,P as $,aa as B,S as Q,a8 as he,K as pe,b7 as q,b8 as ve,O as w,b9 as ee,ba as Ce,ag as ae,ay as Ie,s as Ne,bb as fe,bc as ge,p as be}from"./index-BmPcK3sZ.js";import{CUSTOM_CRS as Ae,generateIcon as Re}from"./Maps-CoC3kT1s.js";const _={companies:[{job:"police",name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png",canCall:!0,canMessage:!0,bossRanks:["boss","lieutenant"],open:!0,location:{name:"Mission Row",coords:{x:428.9,y:-984.5}}},{job:"ambulance",name:"Ambulance",icon:"https://cdn-icons-png.flaticon.com/128/1032/1032989.png",canCall:!0,canMessage:!0,bossRanks:["boss","doctor"],open:!0,location:{name:"Pillbox",coords:{x:304.2,y:-587}}},{job:"mechanic",name:"Mechanic",icon:"https://cdn-icons-png.flaticon.com/128/10281/10281554.png",canCall:!0,canMessage:!0,bossRanks:["boss","worker"],open:!1,location:{name:"LS Customs",coords:{x:-336.6,y:-134.3}}},{job:"taxi",name:"Taxi",icon:"https://cdn-icons-png.flaticon.com/128/433/433449.png",canCall:!0,canMessage:!0,bossRanks:["boss","driver"],open:!1,location:{name:"Taxi HQ",coords:{x:984.2,y:-219}}}],company:{job:"police",duty:!0,receiveCalls:!0,isBoss:!0,balance:1e6,employees:[{id:1,name:"Breze",grade:1,gradeLabel:"Officer",canInteract:!0,online:!0},{id:2,name:"Loaf Scripts",grade:2,gradeLabel:"Sergeant",canInteract:!0,online:!0},{id:3,name:"Kash",grade:3,gradeLabel:"Lieutenant",canInteract:!0,online:!1}],grades:[{label:"Officer",grade:1},{label:"Sergeant",grade:2},{label:"Lieutenant",grade:3},{label:"Captain",grade:4}]},messageList:[{id:"1",lastMessage:"Is anyone available to help me?",sender:"Breze",number:"1234567890",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*2},{id:"2",lastMessage:"Hello, how can i help you?",sender:"Loaf Scripts",number:"4802940940",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*4},{id:"3",lastMessage:"Hey, i need backup at the bank",sender:"Sally",number:"2051440412",company:{name:"Police",icon:"https://cdn-icons-png.flaticon.com/512/7211/7211100.png"},timestamp:Date.now()-1e3*60*60*24*2}],messages:{1:[{id:"1",sender:"1234567890",isSender:!1,content:"Is anyone available to help me?",timestamp:Date.now()-1e3*60*60*2},{id:"2",sender:"1234567323",isSender:!0,content:"Hey, a unit is on its way to your location",timestamp:Date.now()-1e3*60*60*24*2},{id:"3",sender:"1234567890",isSender:!1,content:"i'd like to report a crime, i'm at the pier",timestamp:Date.now()-1e3*60*60*24*2}],2:[{id:"1",sender:"4802940940",content:"Hey, can you help me?",timestamp:Date.now()-1e3*60*60*4},{id:"2",sender:"4802940940",content:"I need a unit to my location",timestamp:Date.now()-1e3*60*60*24*5},{id:"3",sender:"4802940940",content:"I need backup at the bank",timestamp:Date.now()-1e3*60*60*24*9},{id:"4",sender:"4802940940",content:"<!SENT-LOCATION-X=123.123Y=123.123!>",timestamp:Date.now()-1e3*60*60*24*9}],3:[{id:"1",sender:"2051440412",content:"is there any way you have any job positions available?",timestamp:Date.now()-1e3*60*60*24*2},{id:"2",sender:"2051440412",content:"hello?",timestamp:Date.now()-1e3*60*60*24*4},{id:"3",sender:"2051440412",content:"hey, i have a question",timestamp:Date.now()-1e3*60*60*24*5}]},employees:[{firstname:"John",lastname:"Doe",grade:1,gradeLabel:"Officer",number:"1234567890",online:!0},{firstname:"Loaf",lastname:"Scripts",grade:2,gradeLabel:"Sergeant",number:"4802940940",online:!0},{firstname:"Kash",grade:3,gradeLabel:"Lieutenant",number:"2051440412",online:!1},{firstname:"Sally",grade:4,gradeLabel:"Captain",number:"1234567323",online:!0}]};function Oe(){var P,l,o,I,A,R,m,u,T,L,G,X,Z;const a=v(H),t=v(h),[d,c]=p.useState(null);p.useEffect(()=>{Y("Services")&&E("Services",{action:"getCompany"},_.company).then(r=>{if(!r)return C("warning","Failed to fetch company data");h.set(r)})},[]);const i=()=>{f.PopUp.set({title:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:n("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:r=>{c(r)},type:"number"},buttons:[{title:n("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:n("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{c(r=>{/^\d+$/.test(r)&&E("Services",{action:"depositMoney",amount:parseInt(r)},parseInt(r)+t.balance).then(N=>{if(typeof N!="number")return C("warning","Balance is not a number, not updating");h.patch({balance:N})})})}}]})},S=()=>{f.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:n("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:r=>{c(r)},type:"number"},buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{c(r=>{if(/^\d+$/.test(r)){if(t.balance-parseInt(r)<0){f.PopUp.set({title:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:n("APPS.SERVICES.WITHDRAW_POPUP.NOT_ENOUGH_MONEY",{amount:r}),buttons:[{title:n("APPS.SERVICES.WITHDRAW_POPUP.PROCEED")}]});return}E("Services",{action:"withdrawMoney",amount:parseInt(r)},t.balance-parseInt(r)).then(N=>{if(typeof N!="number")return C("warning","Balance is not a number, not updating");h.patch({balance:N})})}})}}]})};return e(y,{children:t!=null&&t.job?s("div",{className:"actions-container",children:[e("div",{className:"category-title",children:n("APPS.SERVICES.SETTINGS")}),e("section",{children:s(y,{children:[t.duty!==void 0&&((l=(P=a==null?void 0:a.Services)==null?void 0:P.Management)==null?void 0:l.Duty)!==!1&&s(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[s("div",{className:"item-data",children:[e(te,{className:"orange"}),s("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.DUTY")}),e("div",{className:"description",children:n("APPS.SERVICES.DUTY_DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(z,{checked:t.duty,onChange:()=>{E("Services",{action:"toggleDuty",duty:!t.duty},!0).then(()=>h.patch({duty:!t.duty}))}})})]}),(t.duty===void 0||t.duty===!0)&&t.receiveCalls!==void 0&&s(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[s("div",{className:"item-data",children:[e(ne,{className:"green"}),s("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.JOB_CALLS")}),s("div",{className:"description",children:[" ",n("APPS.SERVICES.JOB_CALLS_DESCRIPTION",{toggle:t.receiveCalls?n("APPS.SERVICES.DISABLE"):n("APPS.SERVICES.ENABLE")})]})]})]}),e("div",{className:"item-value",children:e(z,{checked:t.receiveCalls,onChange:()=>{E("Services",{action:"toggleCalls"},!t.receiveCalls).then(r=>{h.patch({receiveCalls:r})})}})})]})]})}),t.isBoss&&s(y,{children:[e("div",{className:"category-title",children:n("APPS.SERVICES.ACTIONS")}),s("section",{children:[s(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",children:[s("div",{className:"item-data",children:[e(ie,{className:"green"}),s("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.BALANCE")}),e("div",{className:"description",children:n("APPS.SERVICES.CURRENT_BALANCE")})]})]}),e("div",{className:"item-value",children:a.CurrencyFormat.replace("%s",(o=t.balance)==null?void 0:o.toLocaleString())})]}),(((A=(I=a==null?void 0:a.Services)==null?void 0:I.Management)==null?void 0:A.Deposit)!==!1||((m=(R=a==null?void 0:a.Services)==null?void 0:R.Management)==null?void 0:m.Withdraw)!==!1)&&s("div",{className:"item",children:[((T=(u=a==null?void 0:a.Services)==null?void 0:u.Management)==null?void 0:T.Deposit)!==!1&&e("div",{className:"button",onClick:i,children:n("APPS.SERVICES.DEPOSIT_POPUP.TITLE")}),((G=(L=a==null?void 0:a.Services)==null?void 0:L.Management)==null?void 0:G.Withdraw)!==!1&&e("div",{className:"button",onClick:S,children:n("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]}),e("div",{className:"category-title",children:n("APPS.SERVICES.MANAGE_EMPLOYEES")}),s("section",{children:[((Z=(X=a==null?void 0:a.Services)==null?void 0:X.Management)==null?void 0:Z.Hire)!==!1&&s(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{f.PopUp.set({title:n("APPS.SERVICES.HIRE_POPUP.TITLE"),description:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:n("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:r=>{c(r)}},buttons:[{title:n("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{c(r=>{if(/^\d+$/.test(r))return E("Services",{action:"hireEmployee",source:parseInt(r)},{id:r,name:"Joe Doe"}).then(N=>{var U;N&&h.patch({employees:[...h.value.employees,{id:N.id,name:N.name,grade:0,gradeLabel:(U=h.value)==null?void 0:U.grades[0].label,canInteract:!0}]})}),""})}}]})},children:[s("div",{className:"item-data",children:[e(se,{className:"blue"}),s("div",{className:"item-info",children:[e("div",{className:"title",children:n("APPS.SERVICES.HIRE")}),e("div",{className:"description",children:n("APPS.SERVICES.HIRE_POPUP.DESCRIPTION")})]})]}),e("div",{className:"item-value",children:e(ce,{})})]}),t.employees.map((r,N)=>s(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"item",onClick:()=>{if(!r.canInteract||a.Services.Management.Fire===!1&&a.Services.Management.Promote===!1)return;const U=[a.Services.Management.Promote!==!1&&{title:n("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{f.ContextMenu.set({buttons:[...t.grades.map(b=>({title:b.label,cb:()=>{E("Services",{action:"setGrade",employee:r.id,grade:b.grade},!0).then(W=>{if(!W)return C("warning","Failed to set grade");h.patch({employees:h.value.employees.map(k=>(k.id===r.id&&(k.grade=b.grade,k.gradeLabel=b.label),k))})})}}))]})},300)}},a.Services.Management.Fire!==!1&&{title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{f.PopUp.set({title:n("APPS.SERVICES.FIRE_POPUP.TITLE"),description:n("APPS.SERVICES.FIRE_POPUP.DESCRIPTION",{name:r.name}),buttons:[{title:n("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:n("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{E("Services",{action:"fireEmployee",employee:r.id},!0).then(b=>{if(!b)return C("warning","Failed to fire employee");h.patch({employees:h.value.employees.filter(W=>W.id!==r.id)})})}}]})}}];f.ContextMenu.set({buttons:U.filter(b=>b)})},children:[s("div",{className:"item-data",children:[e(oe,{}),s("div",{className:"item-info",children:[e("div",{className:"title",children:r.name}),s("div",{className:"description",children:[" ",r.gradeLabel]})]})]}),e("div",{className:"item-value",children:e("div",{className:"status","data-online":r.online})})]},N))]})]})]}):e("div",{className:"no-job",children:n("APPS.SERVICES.UNEMPLOYED")})})}function ye({location:a,icon:t}){return p.useEffect(()=>{setTimeout(()=>{const d=document.querySelector(".leaflet-control-attribution.leaflet-control a");d&&(d.removeAttribute("href"),d.onclick=()=>{window.invokeNative("openUrl","https://leafletjs.com/")})},500)},[]),e("div",{className:"mapscomponent-wrapper",children:s(le,{className:"map",crs:Ae,center:[a[0]-100,a[1]],zoom:3,scrollWheelZoom:!1,zoomControl:!1,doubleClickZoom:!1,dragging:!1,bounceAtZoomLimits:!0,boxZoom:!1,maxBoundsViscosity:.95,maxBounds:[[8300,-5600],[-4200,6400]],preferCanvas:!0,attributionControl:!1,children:[e(re,{url:"https://loaf-scripts.com/fivem/lb-phone/map/satellite/{z}/{x}/{y}.png",minZoom:2,maxZoom:8,noWrap:!0}),e(de,{position:a,icon:t??Re()})]})})}function Te(){const a=v(Q),t=v(O),d=v(he),[c,i]=p.useState([]),S=p.useRef(null),[P,l]=p.useState({content:"",attachments:[]});p.useEffect(()=>{E("Services",{action:"getMessages",id:t.id,company:t.job},_.messages[t.id]).then(m=>{if(m&&m.length>0){i([...m.reverse()]);let u=document.querySelector(".chat-container");u.scrollTop=u.scrollHeight}})},[]);const o=()=>{if(!d)return C("warning","Cannot send message without a phone");if(P.content.length>0){let m={id:t.id,company:t.job,isSender:!0,content:P.content,timestamp:new Date};if(a.airplaneMode)return i(u=>[...u,{...m,delivered:!1}]);E("Services",{action:"sendMessage",...m},!0,!0).then(u=>{u||C("error","Failed to send message"),i(T=>[...T,{...m,delivered:u}]),l({content:"",attachments:[]}),S.current.value=""})}},I=()=>{f.PopUp.set({title:n("APPS.SERVICES.SEND_LOCATION_POPUP.TITLE"),description:n("APPS.SERVICES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:n("APPS.SERVICES.SEND_LOCATION_POPUP.CANCEL")},{title:n("APPS.SERVICES.SEND_LOCATION_POPUP.SEND"),cb:()=>{E("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(m=>{if(!m)return C("error","Failed to get location");let u={content:`<!SENT-LOCATION-X=${J(m.x,2)}Y=${J(m.y,2)}!>`,attachments:[],isSender:!0,id:t.id,company:t.job,timestamp:new Date};E("Services",{action:"sendMessage",...u},!0,!0).then(T=>{i(T?L=>[...L,u]:L=>[...L,{...u,delivered:!1}])})})}}]})},{handleScroll:A}=K({fetchData:()=>E("Services",{action:"getMessages",id:t.id,company:t.job,lastId:c[0].id}),onDataFetched:m=>i([...m.reverse(),...c]),isReversed:!0,perPage:25});D("services:newMessage",m=>{if(t.id!==m.channelId||m.isSender||a.airplaneMode)return;i([...c,{...m,timestamp:new Date}]);let u=document.querySelector(".chat-container");u.scrollTop=u.scrollHeight});const R=m=>{if(m)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(m)};return s(y,{children:[s("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{M.set("messages"),O.reset()},children:e(me,{})}),s("div",{className:"user",children:[e("img",{src:`./assets/img/icons/avatar-placeholder-${a.display.theme}.svg`,className:"avatar"}),e("div",{className:"name",children:V(t.number)})]}),e(Se,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:A,children:e("div",{className:"chat-body",children:c.map((m,u)=>e(Le,{index:u,messages:c,message:m,func:{isLocation:R}}))})}),e("div",{className:"chat-bottom",children:s("div",{className:"input",children:[e(ue,{placeholder:n("APPS.SERVICES.PLACEHOLDER"),ref:S,value:P.content,disabled:!d,onChange:m=>{l({content:m.target.value,attachments:P.attachments})},onClick:()=>{if(!d)return C("warning","Cannot send message without a phone")},onKeyDown:m=>{m.key=="Enter"&&o()}}),s("div",{className:"buttons",children:[e("div",{className:"location",children:e(F,{onClick:I})}),P.content.length>0&&d&&e("div",{className:"send",onClick:o,children:e(Pe,{})})]})]})})]})}const Le=({messages:a,message:t,index:d,func:c})=>{var R;const i=v(O);let S=i.number,P,l,o,I=(t==null?void 0:t.sender)===S?"other":"self",A=((R=a[d+1])==null?void 0:R.sender)===S?"other":"self";if(a[d+1]?l=Math.abs(t.timestamp-a[d+1].timestamp)/36e5:A=void 0,c.isLocation(t.content)){let m=t.content.match(/X=(-?\d*\.?\d*)Y/)[1],u=t.content.match(/Y=(-?\d*\.?\d*)!>/)[1];o={x:m,y:u}}return s("div",{className:`message ${I}`,"data-id":t.id,children:[P,t.delivered===!1?s("div",{className:"content-wrapper",children:[e("div",{className:"content",children:t.content}),e(Ee,{})]}):o?s("div",{className:"location",onClick:()=>{$.patch({active:{name:"Maps",data:{location:[o.y,o.x],name:`${V(t.sender)}'s location`,icon:i.icon}}})},children:[e(ye,{location:[o.y,o.x]}),I==="other"&&s("div",{className:"sender",children:[V(t.sender)," ",n("APPS.SERVICES.SENT_LOCATION")]})]}):t.content&&e("div",{className:"content",children:t.content}),t.delivered===!1?e("div",{className:"status",children:n("APPS.SERVICES.NOT_DELIVERED")}):a[d+1]&&l>6?e("div",{className:"date",children:B(t.timestamp)}):I!==A&&e("div",{className:"date",children:B(t.timestamp)})]},d)},x=w(null);function De(){var S,P;const a=v(x),[t,d]=p.useState("all"),[c,i]=p.useState("");return s(g.div,{initial:{opacity:0,y:250},animate:{opacity:1,y:0},exit:{opacity:0,y:250},transition:{duration:.2,ease:"easeInOut"},className:"employee-list",children:[s("div",{className:"employee-list-header",children:[e("div",{className:"close",onClick:()=>x.set(null)}),e("div",{className:"selector",children:["all","available"].map((l,o)=>e("div",{className:"option","data-active":t===l,onClick:()=>d(l),children:n(`APPS.SERVICES.${l.toUpperCase()}`)},o))}),e(pe,{placeholder:n("APPS.SERVICES.SEARCH_EMPLOYEES"),onChange:l=>i(l.target.value)})]}),e("div",{className:"employee-list-body",children:(P=(S=a==null?void 0:a.filter(l=>(t==="all"?!0:l.online)&&q(l.firstname,l.lastname).toLowerCase().includes(c.toLowerCase())))==null?void 0:S.sort((l,o)=>o.grade-l.grade))==null?void 0:P.map((l,o)=>e(g.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"employee-item",children:s("div",{className:"user",children:[e("div",{className:"avatar",children:ve(l.firstname,l.lastname)}),s("div",{className:"info",children:[q(l.firstname,l.lastname),e("span",{children:l.gradeLabel})]})]})},o))})]})}function Ve(){var c;const[a,t]=p.useState([]),d=(c=v($))==null?void 0:c.active;return p.useEffect(()=>{Y("Services")&&E("Services",{action:"getCompanies"},_.companies).then(i=>{if(!i)return C("warning","Failed to fetch companies");t(i)})},[d]),D("services:updateOpen",i=>{if(!i)return;const{job:S,open:P}=i;t(l=>{const o=l.findIndex(I=>I.job===S);return o===-1?l:(l[o].open=P,[...l])})}),e(y,{children:e("div",{className:"companies-list",children:a.sort((i,S)=>i.open&&!S.open?-1:!i.open&&S.open?1:0).map(i=>e(Me,{company:i},i.name))})})}const Me=({company:a})=>{var S,P,l;v(H);const[t,d]=p.useState(!1),c=()=>{E("Services",{action:"getEmployees",company:a.job},_.employees).then(o=>{if(!o)return C("warning","You do not have permission to view employees.");x.set(o)})},i=o=>{var I;!((I=o==null?void 0:o.location)!=null&&I.coords)||!o.name||$.patch({active:{name:"Maps",data:{location:[o.location.coords.y,o.location.coords.x],name:o.name,icon:o.icon}}})};return s("div",{className:"item",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),"data-open":a.open,onClick:c,children:[s("div",{className:"info",children:[a.icon&&e("div",{className:"icon",children:e("img",{src:a.icon})}),s("div",{className:"company-details",children:[e("div",{className:"title",children:a.name}),s("div",{className:"location",children:[e(ee,{}),(S=a.location)==null?void 0:S.name]})]})]}),a.open?s("div",{className:"actions",children:[a.customIcon&&e("div",{className:"custom-icon",onClick:o=>{o.stopPropagation(),E("Services",{action:"customIconClick",company:a.job})},children:Ce[a.customIcon]()}),((P=a.location)==null?void 0:P.coords)&&e(F,{className:"orange",onClick:o=>{o.stopPropagation(),i(a)}})]}):s(y,{children:[e("div",{className:"actions",onMouseEnter:()=>d(!1),onMouseLeave:()=>d(!0),children:((l=a.location)==null?void 0:l.coords)&&e(F,{className:"orange",onClick:o=>{o.stopPropagation(),i(a)}})}),e(ae,{children:t&&e(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"closed",children:n("APPS.SERVICES.CLOSED")})})]})]},a.name)};function we(){const[a,t]=p.useState([]);p.useEffect(()=>{Y("Services")&&E("Services",{action:"getRecentMessages"},_.messageList).then(c=>{if(!c)return C("warning","No recent messages found");t(c)})},[]);const{handleScroll:d}=K({fetchData:c=>E("Services",{action:"getRecentMessages",page:c}),onDataFetched:c=>t([...a,...c]),perPage:15});return D("services:channelDeleted",c=>{if(!c)return C("error","No channel ID provided");t(a.filter(i=>i.id!==c))}),e(y,{children:e("div",{className:"company-messages-container",onScroll:d,children:e("section",{children:a&&a.map((c,i)=>e(_e,{channel:c},i))})})})}const _e=({channel:a})=>{const t=v(Q),d=Ie(()=>{var i;(i=H)!=null&&i.value.Services.DeleteConversations&&f.ContextMenu.set({buttons:[{title:n("APPS.SERVICES.DELETE_CONVERSATION.TITLE"),color:"red",cb:()=>{setTimeout(()=>{f.PopUp.set({title:n("APPS.SERVICES.DELETE_CONVERSATION.TITLE"),description:n("APPS.SERVICES.DELETE_CONVERSATION.DESCRIPTION"),buttons:[{title:n("APPS.SERVICES.DELETE_CONVERSATION.CANCEL")},{title:n("APPS.SERVICES.DELETE_CONVERSATION.DELETE"),color:"red",cb:()=>{E("Services",{action:"deleteChannel",id:a.id},!0).then(S=>{if(!S)return C("error","Failed to delete channel, deleteChannel returned false")})}}]})},100)}}]})}),c=i=>{if(i)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(i)};return s("div",{...d,className:"item",onClick:()=>{var i;O.set({...O==null?void 0:O.value,id:a.id,company:V(a.number),job:(i=a.company)==null?void 0:i.job,number:a.number}),M.set("chat")},children:[e("img",{src:`./assets/img/icons/avatar-placeholder-${t.display.theme}.svg`}),s("div",{className:"info",children:[s("div",{className:"info-header",children:[e("div",{className:"user",children:V(a.number)}),s("div",{className:"right",children:[e("div",{className:"time",children:B(a.timestamp)}),e(Ne,{})]})]}),e("div",{className:"message",children:c(a.lastMessage)?n("APPS.SERVICES.SENT_LOCATION_SHORT"):a.lastMessage})]})]})},j=w([{icon:e(ee,{}),title:n("APPS.SERVICES.COMPANIES"),value:"companies"}]);function Ue(){const a=v(H),t=v(M),d=v(j);return p.useEffect(()=>{var c,i;j.set([...j.value,a.LBPhone&&{icon:e(fe,{}),title:n("APPS.SERVICES.MESSAGES"),value:"messages"},((i=(c=a==null?void 0:a.Services)==null?void 0:c.Management)==null?void 0:i.Enabled)!==!1&&{icon:e(ge,{}),title:n("APPS.SERVICES.ACTIONS"),value:"actions"}].filter(S=>S!==null).filter((S,P,l)=>l.findIndex(o=>(o==null?void 0:o.value)===(S==null?void 0:S.value))===P))},[]),e("div",{className:"companies-footer",children:d.map((c,i)=>s("div",{className:"item","data-active":t===c.value,onClick:()=>M.set(c.value),children:[c.icon,c.title]},i))})}const M=w("companies"),O=w(null),h=w(null);function He(){const a=v(M),t=v(x),d={companies:e(Ve,{}),actions:e(Oe,{}),messages:e(we,{}),chat:e(Te,{})};let c={actions:n("APPS.SERVICES.ACTIONS"),messages:n("APPS.SERVICES.MESSAGES"),companies:n("APPS.SERVICES.COMPANIES")};return D("services:setCompany",i=>h.set(i)),D("services:setDuty",i=>h.patch({duty:i})),s("div",{className:"companies-container","data-view":a,children:[e(ae,{children:t&&e(De,{})}),s(g.div,{...be(a==="chat"?"left":"right",a,.2),className:"companies-wrapper",children:[a!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:c[a]})}),e("div",{className:"companies-body",children:d[a]})]}),a!=="chat"&&e(Ue,{})]})}export{h as CompanyData,O as Data,M as View,He as default};
