import{bM as xe,bd as Fe,bN as We,bO as Be,O as f,u as S,r as N,k as p,ah as ye,bH as ne,a2 as He,n as Ne,J as A,j as t,ag as Ue,a as C,F as y,K as fe,L as a,o as Y,bu as Ie,bp as Ae,bP as _e,b2 as k,bs as D,bQ as Ke,a1 as de,i as w,bL as Te,Y as Me,bF as Ge,a3 as $e,bf as Se,be as qe,a$ as Ve,bg as ze,bh as je,b0 as Ye,bi as Ze,bo as Je,bk as Xe,h as M,R as Qe,V as et,bl as tt}from"./index-BmPcK3sZ.js";function nt(e,i,s){i.center!==s.center&&e.setLatLng(i.center),i.radius!=null&&i.radius!==s.radius&&e.setRadius(i.radius)}const Pe=xe(function({center:i,children:s,...d},o){const c=new Fe.Circle(i,d);return We(c,Be(o,{overlayContainer:c}))},nt),T=f(null),b=f([]);function it(){const e=S(T),i=S(b),s=S(de.APPS.POLICE.permissions),[d,o]=N.useState(""),[c,P]=N.useState("");N.useState(null),N.useEffect(()=>{var l;p("Police",{action:"getWiretaps",query:d},ye()&&((l=ne.wireTaps)==null?void 0:l.filter(n=>n.phoneNumber.toLowerCase().includes(d.toLowerCase())||n.phoneName.toLowerCase().includes(d.toLowerCase())))).then(n=>{n&&b.set(n)})},[d]),N.useEffect(()=>{const l=setTimeout(()=>o(c),500);return()=>clearTimeout(l)},[c]);const{handleScroll:u}=He({fetchData:l=>p("Police",{action:"getWiretaps",query:d,page:l}),onDataFetched:l=>b.set([...b.value,...l]),perPage:25});Ne("police:createWiretap",l=>{if(!l)return A("error","police:createWiretap did not return anything");b.set([...b.value,l])}),Ne("police:removeWiretap",l=>{var n;if(!l)return A("error","police:removeWiretap did not return anything");b.set(b.value.filter(m=>m.phoneNumber!==l)),((n=T.value)==null?void 0:n.phoneNumber)===l&&T.reset()});const r=()=>{let l="";w.PopUp.set({title:a("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.TITLE"),description:a("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.DESCRIPTION"),input:{placeholder:a("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.PLACEHOLDER"),type:"text",minLength:3,value:"",onChange:n=>{l=n}},buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.PROCEED"),cb:()=>{if(!l)return A("warning","No phone number input");p("Police",{action:"wiretapNumber",phoneNumber:l},!0).then(n=>{var E,L;if(!n)return A("error","wiretapNumber did not return anything");let m={phoneNumber:l,phoneName:n.phoneName,subscribed:!1,createdAt:Date.now(),createdBy:(E=Te.value)==null?void 0:E.id,author:(L=Te.value)==null?void 0:L.name};T.set(m)})}}]})};return t("div",{className:"calls-container",children:t(Ue,{children:e?t(at,{}):C(y,{children:[C("div",{className:"search-container buttons",children:[t(fe,{placeholder:"Search wiretaps",onChange:l=>P(l.target.value)}),s.phone.createWiretap&&t("div",{className:"buttons",children:t("div",{className:"button",onClick:r,children:a("APPS.POLICE.ADD")})})]}),C("div",{className:"list",onScroll:u,children:[(i==null?void 0:i.filter(l=>{var n;return(n=l==null?void 0:l.phoneNumber)==null?void 0:n.toLowerCase().includes(d.toLowerCase())}).length)===0&&d.length>0&&t("div",{className:"no-results",children:a("APPS.POLICE.NO_RESULTS_FOR",{query:d})}),i==null?void 0:i.map(l=>C(Y.div,{...Ie,className:"item",onClick:()=>T.set(l),children:[C("div",{className:"img",children:[t("img",{src:Ae(null,"profile")}),t(_e,{})]}),C("div",{className:"info",children:[t("div",{className:"name",children:l.phoneName??k(l.phoneNumber)}),l.phoneName&&t("div",{className:"subtitle",children:k(l.phoneNumber)}),C("div",{className:"cards",children:[t("div",{className:D("card",l.subscribed?"green":"red"),children:l.subscribed?a("APPS.POLICE.PHONE.CALLS.SUBSCRIBED"):a("APPS.POLICE.PHONE.CALLS.NOT_SUBSCRIBED")}),t("div",{className:"divider"}),t("div",{className:D("card",l.inCall?"green":"red"),children:l.inCall?a("APPS.POLICE.PHONE.CALLS.IN_CALL"):a("APPS.POLICE.PHONE.CALLS.NOT_IN_CALL")})]}),C("div",{className:"id report",style:{marginTop:"auto"},children:[t("div",{className:"label",children:a("APPS.POLICE.PHONE.CALLS.FOOTER",{name:l.author})}),t("div",{className:"value",children:Ke(l.createdAt)})]})]})]},l.phoneNumber))]})]})})})}const at=()=>{const e=S(T),[i,s]=N.useState([]),d=S(de.APPS.POLICE.permissions),[o,c]=N.useState(""),[P,u]=N.useState(""),r=()=>{w.PopUp.set({title:a("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.TITLE"),description:a("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.DESCRIPTION",{phoneNumber:k(e==null?void 0:e.phoneNumber)}),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.PROCEED"),color:"red",cb:()=>{p("Police",{action:"removeWiretap",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(n=>{if(!n)return A("error","removeWiretap did not return anything");T.reset(),b.set(b.value.filter(m=>m.phoneNumber!==(e==null?void 0:e.phoneNumber)))})}}]})};N.useEffect(()=>{var n;d.phone.callHistory&&p("Police",{action:"getCallHistory",phoneNumber:e==null?void 0:e.phoneNumber,query:o},ye()&&((n=ne.callHistory)==null?void 0:n.filter(m=>{if(!m)return!1;let E=(e==null?void 0:e.phoneNumber)===m.callee?m.caller:m.callee;return!(m!=null&&m.hideCallerId)&&(E==null?void 0:E.toLowerCase().includes(o.toLowerCase()))}))).then(m=>{if(!m)return A("error","getCallHistory did not return anything");s(m)})},[o]),N.useEffect(()=>{const n=setTimeout(()=>c(P),500);return()=>clearTimeout(n)},[P]);const{handleScroll:l}=He({fetchData:n=>p("Police",{action:"getCallHistory",phoneNumber:e==null?void 0:e.phoneNumber,query:o,page:n}),onDataFetched:n=>s([...i,...n]),perPage:25});return t(y,{children:C("main",{className:"main chat",children:[C("div",{className:"main-header",children:[C("div",{className:"back",onClick:()=>T.reset(),children:[t(Me,{})," ",a("APPS.POLICE.BACK")]}),t("div",{className:"button red",onClick:r,children:a("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.TITLE")})]}),C("div",{className:"main-body full-height",children:[d.phone.callHistory&&C("div",{className:"chats",children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.POLICE.PHONE.CALLS.CALL_HISTORY")})}),t(fe,{placeholder:a("APPS.POLICE.PHONE.CALLS.SEARCH"),onChange:n=>u(n.target.value)}),t("div",{className:"items",onScroll:l,children:i.sort((n,m)=>n.timestamp>m.timestamp?-1:1).map((n,m)=>{let E=(e==null?void 0:e.phoneNumber)===n.callee?n.caller:n.callee,L=(e==null?void 0:e.phoneNumber)===n.callee&&!n.answered,O=(e==null?void 0:e.phoneNumber)===n.callee;return N.createElement(Y.div,{...Ie,key:m,className:"item","data-missed":L,onClick:()=>{n.hideCallerId||Ge(E)}},C("div",{className:"user",children:[t("img",{src:Ae(null,"profile")}),t("div",{className:"info",children:n.hideCallerId?C(y,{children:[a("APPS.POLICE.PHONE.CALLS.NO_CALLER_ID"),C("span",{children:[O?a("APPS.POLICE.PHONE.CALLS.INCOMING"):a("APPS.POLICE.PHONE.CALLS.OUTGOING")," • ",Ee(n.duration)]})]}):C(y,{children:[k(E),C("span",{children:[O?a("APPS.POLICE.PHONE.CALLS.INCOMING"):a("APPS.POLICE.PHONE.CALLS.OUTGOING")," • ",Ee(n.duration)]})]})})]}),t("div",{className:"date",children:$e(n.timestamp)}))})})]}),t("div",{className:"chats room",children:t(Ue,{children:t(st,{})})})]})]})})},st=()=>{var r,l;const e=S(T),i=S(de.APPS.POLICE.permissions),[s,d]=N.useState(!1),[o,c]=N.useState(((r=e==null?void 0:e.inCall)==null?void 0:r.duration)??0);N.useEffect(()=>()=>{s&&p("Police",{action:"stopListeningToWiretap",phoneNumber:e==null?void 0:e.phoneNumber})},[]),N.useEffect(()=>{var m;if(!((m=e==null?void 0:e.inCall)!=null&&m.duration))return;const n=setInterval(()=>{c(E=>E+1)},1e3);return()=>clearInterval(n)},[e==null?void 0:e.inCall]);const P=()=>{let n=!(e!=null&&e.subscribed);w.PopUp.set({title:n?a("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS"):a("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS"),description:n?a("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS_DESCRIPTION"):a("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS_DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.PROCEED"),cb:()=>{p("Police",{action:"toggleSubscribeWiretap",phoneNumber:e==null?void 0:e.phoneNumber,subscribe:n},!0).then(m=>{if(!m)return A("error","toggleSubscribeWiretap did not return anything");T.patch({subscribed:n})})}}]})},u=()=>{w.PopUp.set({title:s?a("APPS.POLICE.PHONE.CALLS.STOP_LISTENING"):a("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL"),description:s?a("APPS.POLICE.PHONE.CALLS.STOP_LISTENING_DESCRIPTION"):a("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL_DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.PROCEED"),cb:()=>{p("Police",{action:s?"stopListeningToWiretap":"listenToWiretap",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(n=>{if(!n)return A("error","listenToWiretap did not return anything");d(!s)})}}]})};return Ne("police:setInCall",n=>{n.number===(e==null?void 0:e.phoneNumber)&&(T.patch({inCall:n.inCall?{inCallWith:n.inCallWith,duration:n.duration??0}:null}),b.set(b.value.map(m=>m.phoneNumber===(e==null?void 0:e.phoneNumber)?{...m,inCall:n.inCall?{inCallWith:n.inCallWith,duration:n.duration??0}:null}:m)))}),C(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.2},className:"active-call",children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.POLICE.PHONE.CALLS.CALL_STATUS")})}),t("div",{className:"call-content",children:t("div",{className:"center",children:s&&(e!=null&&e.inCall)?C("div",{className:"call-info",children:[t("div",{className:"contact",children:k((l=e==null?void 0:e.inCall)==null?void 0:l.inCallWith)}),t("div",{className:"duration",children:Ee(o)}),t("div",{className:"buttons",children:t("div",{className:"button",onClick:u,children:a("APPS.POLICE.PHONE.CALLS.STOP_LISTENING")})})]}):C(y,{children:[C("div",{className:"info",children:[a("APPS.POLICE.PHONE.CALLS.IN_CALL"),":",t("span",{"data-incall":e==null?void 0:e.inCall,children:e!=null&&e.inCall?a("APPS.POLICE.PHONE.CALLS.YES"):a("APPS.POLICE.PHONE.CALLS.NO")})]}),t("div",{className:"buttons",children:e!=null&&e.inCall?i.phone.listenWiretap&&t("div",{className:D("button","green"),onClick:u,children:a("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL")}):t("div",{className:D("button",e!=null&&e.subscribed?"red":"green"),onClick:P,children:e!=null&&e.subscribed?a("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS"):a("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS")})})]})})})]})},Ee=e=>{const i=Math.floor(e/3600),s=Math.floor(e/60),d=e%60;return`${i>0?`${i}:`:""}${s}:${d.toString().padStart(2,"0")}`},ke=f(Je.LOS_SANTOS),Le=f(localStorage.getItem("lb-active-map-type")??Se.mapStyles.render),te=f([]),q=f({}),V=f(!1),ie=f(!1),oe=f(null),ce=f([]),ee=f(0),$=f(null),B=f(500),_=f(null);let I=null;const rt=3,me=3;function lt(){const e=S(ke),i=S(Le),s=Se.mapTypes[e],d=qe(e),o=S(V),c=S(ie);N.useEffect(()=>{p("Police",{action:"getServiceConfig"},{cellTowers:ne.cellTowers,rangeData:ne.cellTowerRanges}).then(u=>{u&&(te.set(u.cellTowers),q.set(u.rangeData))})},[]);const P=o||c;return t("div",{className:"triangulate-container",children:C(Ve,{className:"map",style:{backgroundColor:Se.backgrounds[i]},crs:e==="losSantos"?ze:je,center:s!=null&&s.defaultCenter?[s.defaultCenter[0],s.defaultCenter[1]]:[0,0],zoom:s.initialZoom,minZoom:s.minZoom,maxZoom:s.maxZoom,maxBounds:d,preferCanvas:!0,zoomControl:!1,attributionControl:!1,boxZoom:!1,bounceAtZoomLimits:!0,maxBoundsViscosity:.95,children:[t(mt,{}),t(Ct,{}),t(Ye,{url:Ze[e].tileServer.replace("{layer}",i),noWrap:!0},`${e}-${i}`),P&&t(Pt,{})]},`map-${e}-${i}`)})}const ot={1:"rgba(250,0,0,0.3)",2:"rgba(250,100,0,0.3)",3:"rgba(250,200,0,0.3)",4:"rgba(1, 131, 1, 0.4)"},j=(e,i,s,d)=>(e-s)**2+(i-d)**2,ct=(e,i,s,d,o,c)=>{const P=j(e,i,d,o),u=Math.sqrt(P),r=1e-7;if(u<r&&Math.abs(s-c)<r||u>s+c+r||u<Math.abs(s-c)-r)return null;const l=(s*s-c*c+P)/(2*u),n=s*s-l*l,m=n<r?0:Math.sqrt(n),E=e+l*(d-e)/u,L=i+l*(o-i)/u,O=[L-m*(d-e)/u,E+m*(o-i)/u];if(m===0)return[O];const v=[L+m*(d-e)/u,E-m*(d-e)/u];return[O,v]},ut=(e,i)=>{var c,P;const s=Math.sqrt(j(e.x,e.y,i.x,i.y)),d=q.value,o=Object.keys(d).map(Number).sort((u,r)=>r-u);for(const u of o){const r=d[u]*(((P=(c=M.value.Police)==null?void 0:c.Triangulation)==null?void 0:P.RangeMultiplier)??1);if(r!==void 0&&s<=r)return{detected:!0,color:ot[u],radius:r}}return{detected:!1,color:null,radius:0}},dt=e=>{if(e.length===0)return{position:null,contributingIntersections:[]};if(e.length===1){const c=e[0];return{position:[c.y,c.x],contributingIntersections:[]}}let i=[];for(let c=0;c<e.length;c++)for(let P=c+1;P<e.length;P++){const u=ct(e[c].x,e[c].y,e[c].size,e[P].x,e[P].y,e[P].size);u&&i.push(...u)}if(i.length===0)return{position:null,contributingIntersections:[]};if(e.length===2){const c=i.reduce((u,r)=>u+r[0],0),P=i.reduce((u,r)=>u+r[1],0);return{position:[c/i.length,P/i.length],contributingIntersections:i}}const s=1.5,d=i.filter(c=>{const P=c[0],u=c[1];return e.every(r=>j(u,P,r.x,r.y)<=(r.size+s)**2)}),o=d.length>0?d:i;if(o.length>0){const c=o.reduce((u,r)=>u+r[0],0),P=o.reduce((u,r)=>u+r[1],0);return{position:[c/o.length,P/o.length],contributingIntersections:o}}return{position:null,contributingIntersections:[]}},ve=(e,i,s)=>{var r,l,n;const c=(((r=q.value)==null?void 0:r[1])??1500)*(((n=(l=M.value.Police)==null?void 0:l.Triangulation)==null?void 0:n.RangeMultiplier)??1)*1.5;if(e.length===0||!i)return c;let P;if(e.length===1)P=e[0].size;else{let m=0;if(s.length>0){let L=0;s.forEach(O=>{L=Math.max(L,j(i[1],i[0],O[1],O[0]))}),m=Math.sqrt(L)}else e.length>0?m=e.reduce((L,O)=>L+O.size,0)/e.length*.8:m=c/2;let E=1;e.length===2?E=1.2:e.length>3&&(E=.9),P=m*E,P=Math.min(P,c)}return Math.max(10,P)},Pt=()=>{var ge,be;const e=S(te),i=S(oe),s=S(V),d=S(ie),o=S(ce),c=S(ee),P=S($),u=S(B),r=S(_),l=Xe(),n=N.useRef(null),m=N.useRef(null),E=N.useRef(null),L=N.useRef(null);N.useEffect(()=>{var h,x,F,Z,J;if(s){I&&(clearInterval(I),I=null),ce.set([]),ee.set(0),$.set(null),L.current=null;const K=(((h=q.value)==null?void 0:h[1])??1500)*(((F=(x=M.value.Police)==null?void 0:x.Triangulation)==null?void 0:F.RangeMultiplier)??1);B.set(K),_.set(null),I=setInterval(()=>{const G=ee.value;if(G>=e.length){I&&(clearInterval(I),I=null),V.set(!1),ie.set(!0);let g=L.current?"SUCCESS":"FAILED";w.PopUp.set({title:a(`APPS.POLICE.PHONE.TRIANGULATE.${g}.TITLE`),description:a(`APPS.POLICE.PHONE.TRIANGULATE.${g}.DESCRIPTION`),buttons:[{title:a("APPS.POLICE.OK")}]});return}const H=e[G];let X=!0;if(P&&o.length>=me){const g=j(P[1],P[0],H.x,H.y);Math.sqrt(g)>u*rt&&(X=!1)}if(X&&i){const g=ut(i,H);if(g.detected&&g.color){const R={x:H.x,y:H.y,z:H.z,color:g.color,size:g.radius};ce.set(Q=>Q.some(W=>W.x===R.x&&W.y===R.y)?Q:[...Q,R])}}ee.set(G+1)},((J=(Z=M.value.Police)==null?void 0:Z.Triangulation)==null?void 0:J.CellTowerTime)??500)}else I&&(clearInterval(I),I=null);return()=>{I&&(clearInterval(I),I=null)}},[s,e,i]),N.useEffect(()=>{var G,H,X;const{position:h,contributingIntersections:x}=dt(o);$.set(h),L.current=h;const F=25,Z=F*.2,J=(((G=q.value)==null?void 0:G[1])??1500)*(((X=(H=M.value.Police)==null?void 0:H.Triangulation)==null?void 0:X.RangeMultiplier)??1),K=J*1.5;if(i&&h){let R=ve(o,h,x);const Q=j(h[1],h[0],i.x,i.y),W=Math.sqrt(Q);W>R&&(R=W+Z);let le=Math.max(F,Math.min(K,R)),U=le;o.length>=me?r===null||le<r?(_.set(le),U=le):(U=r,W>U&&(U=W+Z,U=Math.max(F,Math.min(K,U)),U>r&&_.set(U))):r!==null&&_.set(null),B.set(U)}else if(o.length===0)B.set(J),_.set(null),$.set(null),L.current=null;else if(h){let g=ve(o,h,x),R=Math.max(F,Math.min(K,g));B.set(R),o.length<me&&r!==null&&_.set(null)}else B.set(K),_.set(null),$.set(null),L.current=null},[o,i,l,r]),N.useEffect(()=>{n.current&&n.current.bringToFront(),m.current&&m.current.bringToFront(),E.current&&E.current.bringToFront()});const O=s&&!d&&c<e.length?e[c]:null,v=q.value,ae=s&&!d,se=s&&!d&&o.length>0,re=P&&u>0&&(s||d),pe=d?.75:.5,we=((v==null?void 0:v[1])??1500)*.6*(((be=(ge=M.value.Police)==null?void 0:ge.Triangulation)==null?void 0:be.RangeMultiplier)??1);return C(y,{children:[ae&&O&&t(Pe,{center:[O.y,O.x],radius:we,pathOptions:{color:"rgba(220, 220, 220, 0.3)",fillColor:"rgba(220, 220, 220, 0.75)",fillOpacity:.75,weight:1,dashArray:"8, 4"}},`scanning-${O.x}-${O.y}`),se&&o.map((h,x)=>t(Pe,{center:[h.y,h.x],radius:h.size,pathOptions:{color:h.color.replace("0.3","0.7"),fillColor:h.color,fillOpacity:.25,weight:1.5}},`pinging-${h.x}-${h.y}-${x}`)),re&&P&&t(y,{children:t(Pe,{ref:m,center:P,radius:u,pathOptions:{color:"rgba(0, 220, 0, 0.8)",fillColor:`rgba(0, 220, 0, ${pe})`,fillOpacity:pe,weight:2}},"accuracy-area")})]})},mt=()=>{const e=S(V),i=S(oe),s=S(ie),d=()=>{let c="";w.PopUp.set({title:a("APPS.POLICE.PHONE.TRIANGULATE.TITLE"),description:a("APPS.POLICE.PHONE.TRIANGULATE.DESCRIPTION"),input:{placeholder:a("APPS.POLICE.PHONE.TRIANGULATE.PLACEHOLDER"),type:"text",minLength:3,value:"",onChange:P=>{c=P}},buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.PROCEED"),cb:()=>{o(),te.value.length!==0&&p("Police",{action:"triangulate",phoneNumber:c},ne.phonePosition).then(P=>{const u=[...te.value];te.set(u.sort(()=>.5-Math.random())),V.set(!0),P&&oe.set(P)})}}]})},o=()=>{V.set(!1),ie.set(!1),oe.set(null),ce.set([]),ee.set(0),$.set(null),B.set(500),_.set(null),I&&(clearInterval(I),I=null)};return C("div",{className:"search",children:[!e&&t(Qe,{onClick:d}),(e||s||i)&&t(et,{onClick:o})]})},Ct=()=>{const e=S(Le);S(ke);const i=["render","game","print"];return t("div",{className:"options",children:t(tt,{onClick:()=>{const d=i.indexOf(e),o=i[(d+1)%i.length];Le.set(o),localStorage.setItem("lb-active-map-type",o)}})})},De=({timestamp:e,onTimeUp:i,interval:s=1e3})=>{const[d,o]=N.useState(0),[c,P]=N.useState(!1);return N.useEffect(()=>{if(!e){o(0);return}const r=()=>{const n=e-Date.now();o(n),n<=0&&n>-1e3&&!c&&i&&(P(!0),i())};r();const l=setInterval(r,s);return()=>clearInterval(l)},[e,i,s,c]),{remainingTime:d,formattedTime:(r=>{if(r<=0)return"00:00:00";const l=Math.floor(r/(1e3*60*60)),n=Math.floor(r%(1e3*60*60)/(1e3*60)),m=Math.floor(r%(1e3*60)/1e3);return`${l.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`})(d),isTimeUp:d<=0}},ue=f([]),z=f(null);function Nt(){const e=S(ue),i=S(z),[s,d]=N.useState("");return N.useEffect(()=>{p("Police",{action:"getPhones"},[{phoneNumber:"1234567890",phoneName:"John's Phone",unlocked:!0,timeRemaining:0,attempts:1},{phoneNumber:"1234567892",phoneName:"Breze's phone",unlocked:!0,attempts:0,timeRemaining:15},{phoneNumber:"1234567893",phoneName:"Jane's Phone",unlocked:!1,attempts:1}]).then(o=>{if(!o)return A("warning","Failed to get equipped phones");o.forEach(c=>{c.timeRemaining!==void 0&&(c.finishedAt=Date.now()+c.timeRemaining*1e3)}),ue.set(o)})},[]),t("div",{className:"unlock-container",children:i?t(Et,{}):C(y,{children:[t("div",{className:"search-container",children:t(fe,{placeholder:a("APPS.POLICE.PHONE.UNLOCK.SEARCH"),onChange:o=>d(o.target.value)})}),C("div",{className:"list",children:[e.length===0&&s.length===0&&t("div",{className:"no-results",children:a("APPS.POLICE.PHONE.UNLOCK.NO_PHONES")}),(e==null?void 0:e.filter(o=>{var c,P;return o.phoneName?o.phoneName.toLowerCase().includes(s.toLowerCase())||((c=o.phoneNumber)==null?void 0:c.toLowerCase().includes(s.toLowerCase())):(P=o.phoneNumber)==null?void 0:P.toLowerCase().includes(s.toLowerCase())}).length)===0&&s.length>0&&t("div",{className:"no-results",children:a("APPS.POLICE.NO_RESULTS_FOR",{query:s})}),e==null?void 0:e.filter(o=>{var c,P;return o.phoneName?o.phoneName.toLowerCase().includes(s.toLowerCase())||((c=o.phoneNumber)==null?void 0:c.toLowerCase().includes(s.toLowerCase())):(P=o.phoneNumber)==null?void 0:P.toLowerCase().includes(s.toLowerCase())}).map(o=>t(St,{phone:o},o.phoneNumber))]})]})})}const St=({phone:e})=>{var r,l,n,m,E,L,O;const[i,s]=N.useState(e.unlocked&&he(e.finishedAt)),[d,o]=N.useState(!i&&Oe(e.finishedAt)),[c,P]=N.useState(!1);De({timestamp:e.finishedAt,onTimeUp:()=>{o(!1),s(e.unlocked)}});const u=v=>{if(c)return A("warning","Phone is disabled (max attempts reached)");z.set(v)};return N.useEffect(()=>{var ae,se,re;let v=e.unlocked&&he(e.finishedAt);s(v),o(!v&&Oe(e.finishedAt)),P(v?!1:e.attempts>=(((re=(se=(ae=M.value)==null?void 0:ae.Police)==null?void 0:se.PhoneUnlock)==null?void 0:re.Attempts)??1))},[e.unlocked,e.finishedAt]),C(Y.div,{...Ie,className:"item","data-disabled":c,onClick:()=>u(e),children:[C("div",{className:"img",children:[t("img",{src:Ae(null,"profile")}),t(_e,{})]}),C("div",{className:"info",children:[t("div",{className:"name",children:e.phoneName??k(e.phoneNumber)}),e.phoneName&&t("div",{className:"subtitle",children:k(e.phoneNumber)})]}),C("div",{className:"cards",style:{flexWrap:"inherit"},children:[(e==null?void 0:e.attempts)>0&&t("div",{className:D("card",e.attempts===(((n=(l=(r=M.value)==null?void 0:r.Police)==null?void 0:l.PhoneUnlock)==null?void 0:n.Attempts)??1)?"red":"orange"),children:a("APPS.POLICE.PHONE.UNLOCK.ATTEMPTS",{attempts:e.attempts.toString(),maxAttempts:(O=((L=(E=(m=M.value)==null?void 0:m.Police)==null?void 0:E.PhoneUnlock)==null?void 0:L.Attempts)??1)==null?void 0:O.toString()})}),t("div",{className:D("card",i?"green":d?"orange":"red"),children:i?a("APPS.POLICE.PHONE.UNLOCK.PROCESSED"):d?a("APPS.POLICE.PHONE.UNLOCK.PROCESSING"):a("APPS.POLICE.PHONE.UNLOCK.LOCKED")})]})]})},Et=()=>{const e=S(z),[i,s]=N.useState(!1),[d,o]=N.useState(!1),{formattedTime:c}=De({timestamp:e==null?void 0:e.finishedAt,onTimeUp:()=>{s(!1),w.PopUp.set({title:e!=null&&e.unlocked?a("APPS.POLICE.PHONE.UNLOCK.SUCCESS.TITLE"):a("APPS.POLICE.PHONE.UNLOCK.FAILED.TITLE"),description:e!=null&&e.unlocked?a("APPS.POLICE.PHONE.UNLOCK.SUCCESS.DESCRIPTION"):a("APPS.POLICE.PHONE.UNLOCK.FAILED.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.OK")}]})}});N.useEffect(()=>{Oe(e==null?void 0:e.finishedAt)&&s(!0)},[]);const P=()=>{if(e!=null&&e.unlocked)return A("warning","Phone is already unlocked");p("Police",{action:"unlockPhone",phoneNumber:e==null?void 0:e.phoneNumber},{timeRemaining:.25,unlocked:!1}).then(l=>{if(!(l!=null&&l.timeRemaining))return A("error","Failed to process phone");s(!0),z.patch({finishedAt:Date.now()+l.timeRemaining*60*1e3,unlocked:l.unlocked}),ue.set(ue.value.map(n=>n.phoneNumber===(e==null?void 0:e.phoneNumber)?{...n,unlocked:l.unlocked}:n))})},u=()=>{if(!(e!=null&&e.unlocked))return A("warning","Phone is not unlocked");d||p("Police",{action:"resetPin",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(l=>{if(!l)return A("error","Failed to reset pin");o(!0),w.PopUp.set({title:a("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.TITLE"),description:a("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.SUCCESS"),buttons:[{title:a("APPS.POLICE.OK")}]})})},r=(e==null?void 0:e.unlocked)&&he(e==null?void 0:e.finishedAt);return C(Y.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:[C("div",{className:"grid-header",children:[C("div",{className:"back",onClick:()=>z.reset(),children:[t(Me,{})," ",a("APPS.POLICE.BACK")]}),t("div",{className:"title",children:(e==null?void 0:e.phoneName)??k(e==null?void 0:e.phoneNumber)}),t("div",{className:"buttons"})]}),t("div",{className:"unlock-body",children:t("div",{className:"unlocking",children:i?C(y,{children:[t("div",{className:"title",children:a("APPS.POLICE.PHONE.UNLOCK.PROCESSING_PHONE",{phone:(e==null?void 0:e.phoneName)??k(e==null?void 0:e.phoneNumber)})}),t("div",{className:"subtitle tabular",children:a("APPS.POLICE.PHONE.UNLOCK.REMAINING_TIME",{time:c})})]}):t("div",{className:"buttons column",children:r?C(y,{children:[t("div",{className:"title",children:a("APPS.POLICE.PHONE.UNLOCK.SUCCESS.TITLE")}),t("div",{className:"subtitle",children:a("APPS.POLICE.PHONE.UNLOCK.SUCCESS.DESCRIPTION")}),t("div",{className:D("button blue reset",d&&"disabled"),onClick:u,children:a("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.TITLE")})]}):t("div",{className:D("button"),onClick:P,children:a("APPS.POLICE.PHONE.UNLOCK.PROCESS_PHONE")})})})})]})},Oe=e=>e===void 0?!1:e>Date.now(),he=e=>e===void 0?!1:e===0?!0:e<Date.now(),Ce=f("triangulate"),Re={triangulate:{label:a("APPS.POLICE.PHONE.TRIANGULATE.TITLE"),view:t(lt,{})},unlock:{label:a("APPS.POLICE.PHONE.UNLOCK.TITLE"),view:t(Nt,{})},calls:{label:a("APPS.POLICE.PHONE.CALLS.TITLE"),view:t(it,{})}};function Ot(){var P;const e=S(Ce),i=S(z),s=S(T),[d,o]=N.useState(Re);N.useEffect(()=>{const u=Object.fromEntries(Object.entries(Re).filter(([r])=>c(r)));o(u),Ce.set(Object.keys(u)[0])},[]);const c=u=>{var l;let r=(l=de.APPS.POLICE.permissions.value)==null?void 0:l.phone;return r?u==="triangulate"?r==null?void 0:r.triangulate:u==="unlock"?r==null?void 0:r.unlock:u==="calls"?(r==null?void 0:r.callHistory)||(r==null?void 0:r.createWiretap)||(r==null?void 0:r.listenWiretap):!1:!1};return t(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:t("main",{className:"main profiles",children:C("div",{className:"page",style:{gap:e==="calls"&&s||e=="unlock"&&i?"0":"1rem"},children:[C("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.POLICE.PHONE.TITLE")}),t("div",{className:"selector",children:Object.keys(d).map(u=>t("div",{className:"option","data-active":e===u,onClick:()=>Ce.set(u),children:d[u].label},u))}),t("div",{})]}),t("div",{className:"items",style:{padding:e==="calls"&&s||e=="unlock"&&i?"0":"0 0.75rem",overflowY:e==="calls"&&s?"hidden":"auto"},children:(P=d[e])==null?void 0:P.view})]})})})}export{Ot as default};
